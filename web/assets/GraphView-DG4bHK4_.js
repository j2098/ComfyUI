var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{d as defineComponent,u as useExecutionStore,c as computed,a as useSettingStore,b as useWorkflowStore,e as useTitle,o as openBlock,f as createElementBlock,g as useWorkspaceStore,w as watchEffect,h as app,r as resolveDirective,i as withDirectives,v as vShow,j as unref,k as createVNode,s as showNativeMenu,l as script,m as createBaseVNode,n as normalizeStyle,_ as _export_sfc,p as onMounted,q as onBeforeUnmount,t as useSidebarTabStore,x as useBottomPanelStore,y as createBlock,z as withCtx,A as renderSlot,B as createCommentVNode,C as resolveDynamicComponent,F as Fragment,D as renderList,E as toDisplayString,G as script$5,H as markRaw,I as useI18n,J as useCommandStore,K as useCanvasStore,L as LiteGraph,M as useColorPaletteStore,N as watch,O as useNodeDefStore,P as BadgePosition,Q as LGraphBadge,R as _,S as NodeBadgeMode,T as ref,U as useEventListener,V as nextTick,W as st,X as normalizeI18nKey,Y as useTitleEditorStore,Z as LGraphGroup,$ as LGraphNode,a0 as EditableText,a1 as defineStore,a2 as useNodeFrequencyStore,a3 as useNodeBookmarkStore,a4 as highlightQuery,a5 as script$8,a6 as formatNumberWithSuffix,a7 as NodeSourceType,a8 as createTextVNode,a9 as script$9,aa as NodePreview,ab as NodeSearchFilter,ac as script$a,ad as SearchFilterChip,ae as useLitegraphService,af as storeToRefs,ag as isRef,ah as toRaw,ai as LinkReleaseTriggerAction,aj as normalizeClass,ak as useUserStore,al as useDialogStore,am as SettingDialogHeader,an as SettingDialogContent,ao as useKeybindingStore,ap as Teleport,aq as usePragmaticDraggable,ar as usePragmaticDroppable,as as withModifiers,at as mergeProps,au as useWorkflowService,av as useWorkflowBookmarkStore,aw as script$c,ax as script$d,ay as script$e,az as useModelToNodeStore,aA as ComfyNodeDefImpl,aB as ComfyModelDef,aC as ComfyWorkflow,aD as LGraphCanvas,aE as te,aF as LGraph,aG as LLink,aH as DragAndScale,aI as ContextMenu,aJ as CanvasPointer,aK as isImageNode,aL as api,aM as isEmbedded,aN as FlowConfig,aO as getStorageValue,aP as useModelStore,aQ as setStorageValue,aR as LinkMarkerShape,aS as IS_CONTROL_WIDGET,aT as updateControlWidgetLabel,aU as useColorPaletteService,aV as ChangeTracker,aW as createSlots,aX as i18n,aY as useToast,aZ as useToastStore,a_ as useQueueSettingsStore,a$ as script$g,b0 as useQueuePendingTaskCountStore,b1 as useLocalStorage,b2 as useDraggable,b3 as watchDebounced,b4 as inject,b5 as useElementBounding,b6 as script$i,b7 as lodashExports,b8 as useEventBus,b9 as useMenuItemStore,ba as provide,bb as isElectron,bc as electronAPI,bd as isNativeWindow,be as useDialogService,bf as LGraphEventMode,bg as useQueueStore,bh as DEFAULT_DARK_COLOR_PALETTE,bi as DEFAULT_LIGHT_COLOR_PALETTE,bj as t,bk as useErrorHandling}from"./index-Dq4MU_Gs.js";import{s as script$1,a as script$2,b as script$3,c as script$4,d as script$6,e as script$7,f as script$b,g as script$h,h as script$j}from"./index-BJiezNFa.js";import{s as script$f}from"./index-QRFkYiiT.js";import{u as useKeybindingService}from"./keybindingService-DNqcNEsv.js";import{u as useServerConfigStore}from"./serverConfigStore-B6vW-hEU.js";import"./index-BLCNiiQe.js";const DEFAULT_TITLE="ComfyUI",TITLE_SUFFIX=" - ComfyUI",_sfc_main$u=defineComponent({__name:"BrowserTabTitle",setup(__props){const executionStore=useExecutionStore(),executionText=computed(()=>executionStore.isIdle?"":`[${executionStore.executionProgress}%]`),settingStore=useSettingStore(),betaMenuEnabled=computed(()=>settingStore.get("Comfy.UseNewMenu")!=="Disabled"),workflowStore=useWorkflowStore(),isUnsavedText=computed(()=>workflowStore.activeWorkflow?.isModified||!workflowStore.activeWorkflow?.isPersisted?" *":""),workflowNameText=computed(()=>{const workflowName=workflowStore.activeWorkflow?.filename;return workflowName?isUnsavedText.value+workflowName+TITLE_SUFFIX:DEFAULT_TITLE}),nodeExecutionTitle=computed(()=>executionStore.executingNode&&executionStore.executingNodeProgress?`${executionText.value}[${executionStore.executingNodeProgress}%] ${executionStore.executingNode.type}`:""),workflowTitle=computed(()=>executionText.value+(betaMenuEnabled.value?workflowNameText.value:DEFAULT_TITLE)),title=computed(()=>nodeExecutionTitle.value||workflowTitle.value);return useTitle(title),(_ctx,_cache)=>(openBlock(),createElementBlock("div"))}}),_hoisted_1$j={class:"window-actions-spacer"},_sfc_main$t=defineComponent({__name:"MenuHamburger",setup(__props){const workspaceState=useWorkspaceStore(),settingStore=useSettingStore(),exitFocusMode=__name(()=>{workspaceState.focusMode=!1},"exitFocusMode");watchEffect(()=>{settingStore.get("Comfy.UseNewMenu")==="Disabled"&&(workspaceState.focusMode?app.ui.menuContainer.style.display="none":app.ui.menuContainer.style.display="block")});const menuSetting=computed(()=>settingStore.get("Comfy.UseNewMenu")),positionCSS=computed(()=>menuSetting.value==="Bottom"?{bottom:"0px",right:"0px"}:{top:"0px",right:"0px"});return(_ctx,_cache)=>{const _directive_tooltip=resolveDirective("tooltip");return withDirectives((openBlock(),createElementBlock("div",{class:"comfy-menu-hamburger no-drag",style:normalizeStyle(positionCSS.value)},[withDirectives(createVNode(unref(script),{icon:"pi pi-bars",severity:"secondary",text:"",size:"large","aria-label":_ctx.$t("menu.showMenu"),"aria-live":"assertive",onClick:exitFocusMode,onContextmenu:unref(showNativeMenu)},null,8,["aria-label","onContextmenu"]),[[_directive_tooltip,{value:_ctx.$t("menu.showMenu"),showDelay:300}]]),withDirectives(createBaseVNode("div",_hoisted_1$j,null,512),[[vShow,menuSetting.value!=="Bottom"]])],4)),[[vShow,unref(workspaceState).focusMode]])}}}),MenuHamburger=_export_sfc(_sfc_main$t,[["__scopeId","data-v-7ed57d1a"]]),_sfc_main$s=defineComponent({__name:"UnloadWindowConfirmDialog",setup(__props){const settingStore=useSettingStore(),workflowStore=useWorkflowStore(),handleBeforeUnload=__name(event=>{if(settingStore.get("Comfy.Window.UnloadConfirmation")&&workflowStore.modifiedWorkflows.length>0)return event.preventDefault(),!0},"handleBeforeUnload");return onMounted(()=>{window.addEventListener("beforeunload",handleBeforeUnload)}),onBeforeUnmount(()=>{window.removeEventListener("beforeunload",handleBeforeUnload)}),(_ctx,_cache)=>(openBlock(),createElementBlock("div"))}}),_sfc_main$r=defineComponent({__name:"LiteGraphCanvasSplitterOverlay",setup(__props){const settingStore=useSettingStore(),sidebarLocation=computed(()=>settingStore.get("Comfy.Sidebar.Location")),sidebarPanelVisible=computed(()=>useSidebarTabStore().activeSidebarTab!==null),bottomPanelVisible=computed(()=>useBottomPanelStore().bottomPanelVisible),activeSidebarTabId=computed(()=>useSidebarTabStore().activeSidebarTabId);return(_ctx,_cache)=>(openBlock(),createBlock(unref(script$2),{class:"splitter-overlay-root splitter-overlay","pt:gutter":sidebarPanelVisible.value?"":"hidden",key:activeSidebarTabId.value,stateKey:activeSidebarTabId.value,stateStorage:"local"},{default:withCtx(()=>[sidebarLocation.value==="left"?withDirectives((openBlock(),createBlock(unref(script$1),{key:0,class:"side-bar-panel",minSize:10,size:20},{default:withCtx(()=>[renderSlot(_ctx.$slots,"side-bar-panel",{},void 0,!0)]),_:3},512)),[[vShow,sidebarPanelVisible.value]]):createCommentVNode("",!0),createVNode(unref(script$1),{size:100},{default:withCtx(()=>[createVNode(unref(script$2),{class:"splitter-overlay max-w-full",layout:"vertical","pt:gutter":bottomPanelVisible.value?"":"hidden",stateKey:"bottom-panel-splitter",stateStorage:"local"},{default:withCtx(()=>[createVNode(unref(script$1),{class:"graph-canvas-panel relative"},{default:withCtx(()=>[renderSlot(_ctx.$slots,"graph-canvas-panel",{},void 0,!0)]),_:3}),withDirectives(createVNode(unref(script$1),{class:"bottom-panel"},{default:withCtx(()=>[renderSlot(_ctx.$slots,"bottom-panel",{},void 0,!0)]),_:3},512),[[vShow,bottomPanelVisible.value]])]),_:3},8,["pt:gutter"])]),_:3}),sidebarLocation.value==="right"?withDirectives((openBlock(),createBlock(unref(script$1),{key:1,class:"side-bar-panel",minSize:10,size:20},{default:withCtx(()=>[renderSlot(_ctx.$slots,"side-bar-panel",{},void 0,!0)]),_:3},512)),[[vShow,sidebarPanelVisible.value]]):createCommentVNode("",!0)]),_:3},8,["pt:gutter","stateKey"]))}}),LiteGraphCanvasSplitterOverlay=_export_sfc(_sfc_main$r,[["__scopeId","data-v-e50caa15"]]),_sfc_main$q=defineComponent({__name:"ExtensionSlot",props:{extension:{}},setup(__props){const props=__props,mountCustomExtension=__name((extension,el)=>{extension.render(el)},"mountCustomExtension");return onBeforeUnmount(()=>{props.extension.type==="custom"&&props.extension.destroy&&props.extension.destroy()}),(_ctx,_cache)=>_ctx.extension.type==="vue"?(openBlock(),createBlock(resolveDynamicComponent(_ctx.extension.component),{key:0})):(openBlock(),createElementBlock("div",{key:1,ref:__name(el=>{el&&mountCustomExtension(props.extension,el)},"ref")},null,512))}}),_hoisted_1$i={class:"flex flex-col h-full"},_hoisted_2$6={class:"w-full flex justify-between"},_hoisted_3$5={class:"tabs-container"},_hoisted_4$1={class:"font-bold"},_hoisted_5$1={class:"flex-grow h-0"},_sfc_main$p=defineComponent({__name:"BottomPanel",setup(__props){const bottomPanelStore=useBottomPanelStore();return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$i,[createVNode(unref(script$5),{value:unref(bottomPanelStore).activeBottomPanelTabId,"onUpdate:value":_cache[1]||(_cache[1]=$event=>unref(bottomPanelStore).activeBottomPanelTabId=$event)},{default:withCtx(()=>[createVNode(unref(script$3),{"pt:tabList":"border-none"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$6,[createBaseVNode("div",_hoisted_3$5,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(bottomPanelStore).bottomPanelTabs,tab=>(openBlock(),createBlock(unref(script$4),{key:tab.id,value:tab.id,class:"p-3 border-none"},{default:withCtx(()=>[createBaseVNode("span",_hoisted_4$1,toDisplayString(tab.title.toUpperCase()),1)]),_:2},1032,["value"]))),128))]),createVNode(unref(script),{class:"justify-self-end",icon:"pi pi-times",severity:"secondary",size:"small",text:"",onClick:_cache[0]||(_cache[0]=$event=>unref(bottomPanelStore).bottomPanelVisible=!1)})])]),_:1})]),_:1},8,["value"]),createBaseVNode("div",_hoisted_5$1,[unref(bottomPanelStore).bottomPanelVisible&&unref(bottomPanelStore).activeBottomPanelTab?(openBlock(),createBlock(_sfc_main$q,{key:0,extension:unref(bottomPanelStore).activeBottomPanelTab},null,8,["extension"])):createCommentVNode("",!0)])]))}}),_hoisted_1$h={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"};function render$7(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$h,_cache[0]||(_cache[0]=[createBaseVNode("path",{fill:"currentColor",d:"M921.088 103.232L584.832 889.024L465.52 544.512L121.328 440.48zM1004.46.769c-6.096 0-13.52 1.728-22.096 5.36L27.708 411.2c-34.383 14.592-36.56 42.704-4.847 62.464l395.296 123.584l129.36 403.264c9.28 15.184 20.496 22.72 31.263 22.72c11.936 0 23.296-9.152 31.04-27.248l408.272-953.728C1029.148 16.368 1022.86.769 1004.46.769"},null,-1)]))}__name(render$7,"render$7");const __unplugin_components_1$2=markRaw({name:"simple-line-icons-cursor",render:render$7}),_hoisted_1$g={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function render$6(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$g,_cache[0]||(_cache[0]=[createBaseVNode("path",{fill:"currentColor",d:"M10.05 23q-.75 0-1.4-.337T7.575 21.7L1.2 12.375l.6-.575q.475-.475 1.125-.55t1.175.3L7 13.575V4q0-.425.288-.712T8 3t.713.288T9 4v13.425l-3.7-2.6l3.925 5.725q.125.2.35.325t.475.125H17q.825 0 1.413-.587T19 19V5q0-.425.288-.712T20 4t.713.288T21 5v14q0 1.65-1.175 2.825T17 23zM11 12V2q0-.425.288-.712T12 1t.713.288T13 2v10zm4 0V3q0-.425.288-.712T16 2t.713.288T17 3v9zm-2.85 4.5"},null,-1)]))}__name(render$6,"render$6");const __unplugin_components_0$2=markRaw({name:"material-symbols-pan-tool-outline",render:render$6}),_sfc_main$o=defineComponent({__name:"GraphCanvasMenu",setup(__props){const{t:t2}=useI18n(),commandStore=useCommandStore(),canvasStore=useCanvasStore(),settingStore=useSettingStore(),linkHidden=computed(()=>settingStore.get("Comfy.LinkRenderMode")===LiteGraph.HIDDEN_LINK);let interval=null;const repeat=__name(command=>{if(interval)return;const cmd=__name(()=>commandStore.execute(command),"cmd");cmd(),interval=window.setInterval(cmd,100)},"repeat"),stopRepeat=__name(()=>{interval&&(clearInterval(interval),interval=null)},"stopRepeat");return(_ctx,_cache)=>{const _component_i_material_symbols58pan_tool_outline=__unplugin_components_0$2,_component_i_simple_line_icons58cursor=__unplugin_components_1$2,_directive_tooltip=resolveDirective("tooltip");return openBlock(),createBlock(unref(script$6),{class:"p-buttongroup-vertical absolute bottom-[10px] right-[10px] z-[1000] pointer-events-auto"},{default:withCtx(()=>[withDirectives(createVNode(unref(script),{severity:"secondary",icon:"pi pi-plus","aria-label":_ctx.$t("graphCanvasMenu.zoomIn"),onMousedown:_cache[0]||(_cache[0]=$event=>repeat("Comfy.Canvas.ZoomIn")),onMouseup:stopRepeat},null,8,["aria-label"]),[[_directive_tooltip,unref(t2)("graphCanvasMenu.zoomIn"),void 0,{left:!0}]]),withDirectives(createVNode(unref(script),{severity:"secondary",icon:"pi pi-minus","aria-label":_ctx.$t("graphCanvasMenu.zoomOut"),onMousedown:_cache[1]||(_cache[1]=$event=>repeat("Comfy.Canvas.ZoomOut")),onMouseup:stopRepeat},null,8,["aria-label"]),[[_directive_tooltip,unref(t2)("graphCanvasMenu.zoomOut"),void 0,{left:!0}]]),withDirectives(createVNode(unref(script),{severity:"secondary",icon:"pi pi-expand","aria-label":_ctx.$t("graphCanvasMenu.fitView"),onClick:_cache[2]||(_cache[2]=()=>unref(commandStore).execute("Comfy.Canvas.FitView"))},null,8,["aria-label"]),[[_directive_tooltip,unref(t2)("graphCanvasMenu.fitView"),void 0,{left:!0}]]),withDirectives((openBlock(),createBlock(unref(script),{severity:"secondary","aria-label":unref(t2)("graphCanvasMenu."+(unref(canvasStore).canvas?.read_only?"panMode":"selectMode")),onClick:_cache[3]||(_cache[3]=()=>unref(commandStore).execute("Comfy.Canvas.ToggleLock"))},{icon:withCtx(()=>[unref(canvasStore).canvas?.read_only?(openBlock(),createBlock(_component_i_material_symbols58pan_tool_outline,{key:0})):(openBlock(),createBlock(_component_i_simple_line_icons58cursor,{key:1}))]),_:1},8,["aria-label"])),[[_directive_tooltip,unref(t2)("graphCanvasMenu."+(unref(canvasStore).canvas?.read_only?"panMode":"selectMode"))+" (Space)",void 0,{left:!0}]]),withDirectives(createVNode(unref(script),{severity:"secondary",icon:linkHidden.value?"pi pi-eye-slash":"pi pi-eye","aria-label":_ctx.$t("graphCanvasMenu.toggleLinkVisibility"),onClick:_cache[4]||(_cache[4]=()=>unref(commandStore).execute("Comfy.Canvas.ToggleLinkVisibility")),"data-testid":"toggle-link-visibility-button"},null,8,["icon","aria-label"]),[[_directive_tooltip,unref(t2)("graphCanvasMenu.toggleLinkVisibility"),void 0,{left:!0}]])]),_:1})}}}),GraphCanvasMenu=_export_sfc(_sfc_main$o,[["__scopeId","data-v-cb8f9a1a"]]),_sfc_main$n=defineComponent({__name:"NodeBadge",setup(__props){const settingStore=useSettingStore(),colorPaletteStore=useColorPaletteStore(),nodeSourceBadgeMode=computed(()=>settingStore.get("Comfy.NodeBadge.NodeSourceBadgeMode")),nodeIdBadgeMode=computed(()=>settingStore.get("Comfy.NodeBadge.NodeIdBadgeMode")),nodeLifeCycleBadgeMode=computed(()=>settingStore.get("Comfy.NodeBadge.NodeLifeCycleBadgeMode"));watch([nodeSourceBadgeMode,nodeIdBadgeMode,nodeLifeCycleBadgeMode],()=>{app.graph?.setDirtyCanvas(!0,!0)});const nodeDefStore=useNodeDefStore();function badgeTextVisible(nodeDef,badgeMode){return!(badgeMode===NodeBadgeMode.None||nodeDef?.isCoreNode&&badgeMode===NodeBadgeMode.HideBuiltIn)}return __name(badgeTextVisible,"badgeTextVisible"),onMounted(()=>{app.registerExtension({name:"Comfy.NodeBadge",nodeCreated(node){node.badgePosition=BadgePosition.TopRight;const badge=computed(()=>{const nodeDef=nodeDefStore.fromLGraphNode(node);return new LGraphBadge({text:_.truncate([badgeTextVisible(nodeDef,nodeIdBadgeMode.value)?`#${node.id}`:"",badgeTextVisible(nodeDef,nodeLifeCycleBadgeMode.value)?nodeDef?.nodeLifeCycleBadgeText??"":"",badgeTextVisible(nodeDef,nodeSourceBadgeMode.value)?nodeDef?.nodeSource?.badgeText??"":""].filter(s=>s.length>0).join(" "),{length:31}),fgColor:colorPaletteStore.completedActivePalette.colors.litegraph_base.BADGE_FG_COLOR,bgColor:colorPaletteStore.completedActivePalette.colors.litegraph_base.BADGE_BG_COLOR})});node.badges.push(()=>badge.value)}})}),(_ctx,_cache)=>(openBlock(),createElementBlock("div"))}}),_sfc_main$m=defineComponent({__name:"NodeTooltip",setup(__props){let idleTimeout;const nodeDefStore=useNodeDefStore(),settingStore=useSettingStore(),tooltipRef=ref(),tooltipText=ref(""),left=ref(),top=ref(),hideTooltip=__name(()=>tooltipText.value=null,"hideTooltip"),showTooltip=__name(async tooltip=>{if(!tooltip)return;left.value=app.canvas.mouse[0]+"px",top.value=app.canvas.mouse[1]+"px",tooltipText.value=tooltip,await nextTick();const rect=tooltipRef.value.getBoundingClientRect();rect.right>window.innerWidth&&(left.value=app.canvas.mouse[0]-rect.width+"px"),rect.top<0&&(top.value=app.canvas.mouse[1]+rect.height+"px")},"showTooltip"),onIdle=__name(()=>{const{canvas}=app,node=canvas.node_over;if(!node)return;const ctor=node.constructor,nodeDef=nodeDefStore.nodeDefsByName[node.type];if(ctor.title_mode!==LiteGraph.NO_TITLE&&canvas.graph_mouse[1]<node.pos[1])return showTooltip(nodeDef.description);if(node.flags?.collapsed)return;const inputSlot=canvas.isOverNodeInput(node,canvas.graph_mouse[0],canvas.graph_mouse[1],[0,0]);if(inputSlot!==-1){const inputName=node.inputs[inputSlot].name,translatedTooltip=st(`nodeDefs.${normalizeI18nKey(node.type)}.inputs.${normalizeI18nKey(inputName)}.tooltip`,nodeDef.inputs.getInput(inputName)?.tooltip);return showTooltip(translatedTooltip)}const outputSlot=canvas.isOverNodeOutput(node,canvas.graph_mouse[0],canvas.graph_mouse[1],[0,0]);if(outputSlot!==-1){const translatedTooltip=st(`nodeDefs.${normalizeI18nKey(node.type)}.outputs.${outputSlot}.tooltip`,nodeDef.outputs.all?.[outputSlot]?.tooltip);return showTooltip(translatedTooltip)}const widget=app.canvas.getWidgetAtCursor();if(widget&&!widget.element){const translatedTooltip=st(`nodeDefs.${normalizeI18nKey(node.type)}.inputs.${normalizeI18nKey(widget.name)}.tooltip`,nodeDef.inputs.getInput(widget.name)?.tooltip);return showTooltip(widget.tooltip??translatedTooltip)}},"onIdle");return useEventListener(window,"mousemove",__name(e=>{hideTooltip(),clearTimeout(idleTimeout),e.target.nodeName==="CANVAS"&&(idleTimeout=window.setTimeout(onIdle,settingStore.get("LiteGraph.Node.TooltipDelay")))},"onMouseMove")),useEventListener(window,"click",hideTooltip),(_ctx,_cache)=>tooltipText.value?(openBlock(),createElementBlock("div",{key:0,ref_key:"tooltipRef",ref:tooltipRef,class:"node-tooltip",style:normalizeStyle({left:left.value,top:top.value})},toDisplayString(tooltipText.value),5)):createCommentVNode("",!0)}}),NodeTooltip=_export_sfc(_sfc_main$m,[["__scopeId","data-v-f03142eb"]]),_sfc_main$l=defineComponent({__name:"TitleEditor",setup(__props){const settingStore=useSettingStore(),showInput=ref(!1),editedTitle=ref(""),inputStyle=ref({position:"fixed",left:"0px",top:"0px",width:"200px",height:"20px",fontSize:"12px"}),titleEditorStore=useTitleEditorStore(),canvasStore=useCanvasStore(),previousCanvasDraggable=ref(!0),onEdit=__name(newValue=>{titleEditorStore.titleEditorTarget&&newValue.trim()!==""&&(titleEditorStore.titleEditorTarget.title=newValue.trim(),app.graph.setDirtyCanvas(!0,!0)),showInput.value=!1,titleEditorStore.titleEditorTarget=null,canvasStore.canvas.allow_dragcanvas=previousCanvasDraggable.value},"onEdit");return watch(()=>titleEditorStore.titleEditorTarget,target=>{if(target!==null){if(editedTitle.value=target.title,showInput.value=!0,previousCanvasDraggable.value=canvasStore.canvas.allow_dragcanvas,canvasStore.canvas.allow_dragcanvas=!1,target instanceof LGraphGroup){const group=target,[x,y]=group.pos,[w,h]=group.size,[left,top]=app.canvasPosToClientPos([x,y]);inputStyle.value.left=`${left}px`,inputStyle.value.top=`${top}px`;const width=w*app.canvas.ds.scale,height=group.titleHeight*app.canvas.ds.scale;inputStyle.value.width=`${width}px`,inputStyle.value.height=`${height}px`;const fontSize=group.font_size*app.canvas.ds.scale;inputStyle.value.fontSize=`${fontSize}px`}else if(target instanceof LGraphNode){const node=target,[x,y]=node.getBounding(),canvasWidth=node.width,canvasHeight=LiteGraph.NODE_TITLE_HEIGHT,[left,top]=app.canvasPosToClientPos([x,y]);inputStyle.value.left=`${left}px`,inputStyle.value.top=`${top}px`;const width=canvasWidth*app.canvas.ds.scale,height=canvasHeight*app.canvas.ds.scale;inputStyle.value.width=`${width}px`,inputStyle.value.height=`${height}px`;const fontSize=12*app.canvas.ds.scale;inputStyle.value.fontSize=`${fontSize}px`}}}),useEventListener(document,"litegraph:canvas",__name(event=>{if(event.detail.subType==="group-double-click"){if(!settingStore.get("Comfy.Group.DoubleClickTitleToEdit"))return;const group=event.detail.group,[x,y]=group.pos;event.detail.originalEvent.canvasY-y<=group.titleHeight&&(titleEditorStore.titleEditorTarget=group)}else if(event.detail.subType==="node-double-click"){if(!settingStore.get("Comfy.Node.DoubleClickTitleToEdit"))return;const node=event.detail.node,[x,y]=node.pos;event.detail.originalEvent.canvasY-y<=0&&(titleEditorStore.titleEditorTarget=node)}},"canvasEventHandler")),(_ctx,_cache)=>showInput.value?(openBlock(),createElementBlock("div",{key:0,class:"group-title-editor node-title-editor",style:normalizeStyle(inputStyle.value)},[createVNode(EditableText,{isEditing:showInput.value,modelValue:editedTitle.value,onEdit},null,8,["isEditing","modelValue"])],4)):createCommentVNode("",!0)}}),TitleEditor=_export_sfc(_sfc_main$l,[["__scopeId","data-v-12d3fd12"]]),useSearchBoxStore=defineStore("searchBox",()=>{const visible=ref(!1);function toggleVisible(){visible.value=!visible.value}return __name(toggleVisible,"toggleVisible"),{visible,toggleVisible}});class ConnectingLinkImpl{static{__name(this,"ConnectingLinkImpl")}constructor(node,slot,input,output,pos,afterRerouteId){this.node=node,this.slot=slot,this.input=input,this.output=output,this.pos=pos,this.afterRerouteId=afterRerouteId}static createFromPlainObject(obj){return new ConnectingLinkImpl(obj.node,obj.slot,obj.input,obj.output,obj.pos,obj.afterRerouteId)}get type(){const result=this.input?this.input.type:this.output?.type??null;return result===-1?null:result}get releaseSlotType(){return this.output?"input":"output"}connectTo(newNode){const newNodeSlots=this.releaseSlotType==="output"?newNode.outputs:newNode.inputs;if(!newNodeSlots)return;const newNodeSlot=newNodeSlots.findIndex(slot=>LiteGraph.isValidConnection(slot.type,this.type));if(newNodeSlot===-1){console.warn(`Could not find slot with type ${this.type} on node ${newNode.title}. This should never happen`);return}this.releaseSlotType==="input"?this.node.connect(this.slot,newNode,newNodeSlot,this.afterRerouteId):newNode.connect(newNodeSlot,this.node,this.slot,this.afterRerouteId)}}const _sfc_main$k={name:"AutoCompletePlus",extends:script$7,emits:["focused-option-changed"],data(){return{isComposing:!1}},mounted(){typeof script$7.mounted=="function"&&script$7.mounted.call(this);const inputEl=this.$el.querySelector("input");inputEl&&(inputEl.addEventListener("compositionstart",()=>{this.isComposing=!0}),inputEl.addEventListener("compositionend",()=>{this.isComposing=!1})),this.$watch(()=>this.focusedOptionIndex,(newVal,oldVal)=>{this.$emit("focused-option-changed",newVal)})},methods:{onKeyDown(event){if(event.key==="Enter"&&this.isComposing){event.preventDefault(),event.stopPropagation();return}script$7.methods.onKeyDown.call(this,event)}}},_hoisted_1$f={class:"option-container flex justify-between items-center px-2 py-0 cursor-pointer overflow-hidden w-full"},_hoisted_2$5={class:"option-display-name font-semibold flex flex-col"},_hoisted_3$4={key:0},_hoisted_4=["innerHTML"],_hoisted_5=["innerHTML"],_hoisted_6={key:0,class:"option-category font-light text-sm text-muted overflow-hidden text-ellipsis whitespace-nowrap"},_hoisted_7={class:"option-badges"},_sfc_main$j=defineComponent({__name:"NodeSearchItem",props:{nodeDef:{},currentQuery:{}},setup(__props){const settingStore=useSettingStore(),showCategory=computed(()=>settingStore.get("Comfy.NodeSearchBoxImpl.ShowCategory")),showIdName=computed(()=>settingStore.get("Comfy.NodeSearchBoxImpl.ShowIdName")),showNodeFrequency=computed(()=>settingStore.get("Comfy.NodeSearchBoxImpl.ShowNodeFrequency")),nodeFrequencyStore=useNodeFrequencyStore(),nodeFrequency=computed(()=>nodeFrequencyStore.getNodeFrequency(props.nodeDef)),nodeBookmarkStore=useNodeBookmarkStore(),isBookmarked=computed(()=>nodeBookmarkStore.isBookmarked(props.nodeDef)),props=__props;return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$f,[createBaseVNode("div",_hoisted_2$5,[createBaseVNode("div",null,[isBookmarked.value?(openBlock(),createElementBlock("span",_hoisted_3$4,_cache[0]||(_cache[0]=[createBaseVNode("i",{class:"pi pi-bookmark-fill text-sm mr-1"},null,-1)]))):createCommentVNode("",!0),createBaseVNode("span",{innerHTML:unref(highlightQuery)(_ctx.nodeDef.display_name,_ctx.currentQuery)},null,8,_hoisted_4),_cache[1]||(_cache[1]=createBaseVNode("span",null," ",-1)),showIdName.value?(openBlock(),createBlock(unref(script$8),{key:1,severity:"secondary"},{default:withCtx(()=>[createBaseVNode("span",{innerHTML:unref(highlightQuery)(_ctx.nodeDef.name,_ctx.currentQuery)},null,8,_hoisted_5)]),_:1})):createCommentVNode("",!0)]),showCategory.value?(openBlock(),createElementBlock("div",_hoisted_6,toDisplayString(_ctx.nodeDef.category.replaceAll("/"," > ")),1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_7,[_ctx.nodeDef.experimental?(openBlock(),createBlock(unref(script$8),{key:0,value:_ctx.$t("g.experimental"),severity:"primary"},null,8,["value"])):createCommentVNode("",!0),_ctx.nodeDef.deprecated?(openBlock(),createBlock(unref(script$8),{key:1,value:_ctx.$t("g.deprecated"),severity:"danger"},null,8,["value"])):createCommentVNode("",!0),showNodeFrequency.value&&nodeFrequency.value>0?(openBlock(),createBlock(unref(script$8),{key:2,value:unref(formatNumberWithSuffix)(nodeFrequency.value,{roundToInt:!0}),severity:"secondary"},null,8,["value"])):createCommentVNode("",!0),_ctx.nodeDef.nodeSource.type!==unref(NodeSourceType).Unknown?(openBlock(),createBlock(unref(script$9),{key:3,class:"text-sm font-light"},{default:withCtx(()=>[createTextVNode(toDisplayString(_ctx.nodeDef.nodeSource.displayText),1)]),_:1})):createCommentVNode("",!0)])]))}}),NodeSearchItem=_export_sfc(_sfc_main$j,[["__scopeId","data-v-fd0a74bd"]]),_hoisted_1$e={class:"comfy-vue-node-search-container flex justify-center items-center w-full min-w-96 pointer-events-auto"},_hoisted_2$4={key:0,class:"comfy-vue-node-preview-container absolute left-[-350px] top-[50px]"},_hoisted_3$3={class:"_dialog-body"},_sfc_main$i=defineComponent({__name:"NodeSearchBox",props:{filters:{},searchLimit:{default:64}},emits:["addFilter","removeFilter","addNode"],setup(__props,{emit:__emit}){const settingStore=useSettingStore(),{t:t2}=useI18n(),enableNodePreview=computed(()=>settingStore.get("Comfy.NodeSearchBoxImpl.NodePreview")),props=__props,nodeSearchFilterVisible=ref(!1),inputId=`comfy-vue-node-search-box-input-${Math.random()}`,suggestions=ref([]),hoveredSuggestion=ref(null),currentQuery=ref(""),placeholder=computed(()=>props.filters.length===0?t2("g.searchNodes")+"...":""),nodeDefStore=useNodeDefStore(),nodeFrequencyStore=useNodeFrequencyStore(),search=__name(query=>{const queryIsEmpty=query===""&&props.filters.length===0;currentQuery.value=query,suggestions.value=queryIsEmpty?nodeFrequencyStore.topNodeDefs:[...nodeDefStore.nodeSearchService.searchNode(query,props.filters,{limit:props.searchLimit})]},"search"),emit=__emit;let inputElement=null;const reFocusInput=__name(()=>{inputElement??=document.getElementById(inputId),inputElement&&(inputElement.blur(),nextTick(()=>inputElement?.focus()))},"reFocusInput");onMounted(reFocusInput);const onAddFilter=__name(filterAndValue=>{nodeSearchFilterVisible.value=!1,emit("addFilter",filterAndValue)},"onAddFilter"),onRemoveFilter=__name((event,filterAndValue)=>{event.stopPropagation(),event.preventDefault(),emit("removeFilter",filterAndValue),reFocusInput()},"onRemoveFilter"),setHoverSuggestion=__name(index=>{if(index===-1){hoveredSuggestion.value=null;return}const value=suggestions.value[index];hoveredSuggestion.value=value},"setHoverSuggestion");return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$e,[enableNodePreview.value?(openBlock(),createElementBlock("div",_hoisted_2$4,[hoveredSuggestion.value?(openBlock(),createBlock(NodePreview,{nodeDef:hoveredSuggestion.value,key:hoveredSuggestion.value?.name||""},null,8,["nodeDef"])):createCommentVNode("",!0)])):createCommentVNode("",!0),createVNode(unref(script),{icon:"pi pi-filter",severity:"secondary",class:"filter-button z-10",onClick:_cache[0]||(_cache[0]=$event=>nodeSearchFilterVisible.value=!0)}),createVNode(unref(script$a),{visible:nodeSearchFilterVisible.value,"onUpdate:visible":_cache[1]||(_cache[1]=$event=>nodeSearchFilterVisible.value=$event),class:"min-w-96","dismissable-mask":"",modal:"",onHide:reFocusInput},{header:withCtx(()=>_cache[5]||(_cache[5]=[createBaseVNode("h3",null,"Add node filter condition",-1)])),default:withCtx(()=>[createBaseVNode("div",_hoisted_3$3,[createVNode(NodeSearchFilter,{onAddFilter})])]),_:1},8,["visible"]),createVNode(_sfc_main$k,{"model-value":props.filters,class:"comfy-vue-node-search-box z-10 flex-grow",scrollHeight:"40vh",placeholder:placeholder.value,"input-id":inputId,"append-to":"self",suggestions:suggestions.value,"min-length":0,delay:100,loading:!unref(nodeFrequencyStore).isLoaded,onComplete:_cache[2]||(_cache[2]=$event=>search($event.query)),onOptionSelect:_cache[3]||(_cache[3]=$event=>emit("addNode",$event.value)),onFocusedOptionChanged:_cache[4]||(_cache[4]=$event=>setHoverSuggestion($event)),"complete-on-focus":"","auto-option-focus":"","force-selection":"",multiple:"",optionLabel:"display_name"},{option:withCtx(({option})=>[createVNode(NodeSearchItem,{nodeDef:option,currentQuery:currentQuery.value},null,8,["nodeDef","currentQuery"])]),chip:withCtx(({value})=>[Array.isArray(value)&&value.length===2?(openBlock(),createBlock(SearchFilterChip,{key:`${value[0].id}-${value[1]}`,onRemove:__name($event=>onRemoveFilter($event,value),"onRemove"),text:value[1],badge:value[0].invokeSequence.toUpperCase(),"badge-class":value[0].invokeSequence+"-badge"},null,8,["onRemove","text","badge","badge-class"])):createCommentVNode("",!0)]),_:1},8,["model-value","placeholder","suggestions","loading"])]))}}),_sfc_main$h=defineComponent({__name:"NodeSearchBoxPopover",setup(__props){const settingStore=useSettingStore(),litegraphService=useLitegraphService(),{visible}=storeToRefs(useSearchBoxStore()),dismissable=ref(!0),triggerEvent=ref(null),getNewNodeLocation=__name(()=>{if(!triggerEvent.value)return litegraphService.getCanvasCenter();const originalEvent=triggerEvent.value.detail.originalEvent;return[originalEvent.canvasX,originalEvent.canvasY]},"getNewNodeLocation"),nodeFilters=ref([]),addFilter=__name(filter=>{nodeFilters.value.push(filter)},"addFilter"),removeFilter=__name(filter=>{nodeFilters.value=nodeFilters.value.filter(f=>toRaw(f)!==toRaw(filter))},"removeFilter"),clearFilters=__name(()=>{nodeFilters.value=[]},"clearFilters"),closeDialog=__name(()=>{visible.value=!1},"closeDialog"),addNode=__name(nodeDef=>{const node=litegraphService.addNodeOnGraph(nodeDef,{pos:getNewNodeLocation()}),eventDetail=triggerEvent.value?.detail;eventDetail&&eventDetail.subType==="empty-release"&&eventDetail.linkReleaseContext.links.forEach(link=>{ConnectingLinkImpl.createFromPlainObject(link).connectTo(node)}),window.setTimeout(()=>{closeDialog()},100)},"addNode"),newSearchBoxEnabled=computed(()=>settingStore.get("Comfy.NodeSearchBoxImpl")==="default"),showSearchBox=__name(e=>{const detail=e.detail;newSearchBoxEnabled.value?detail.originalEvent?.pointerType==="touch"?setTimeout(()=>{showNewSearchBox(e)},128):showNewSearchBox(e):canvasStore.canvas.showSearchBox(detail.originalEvent)},"showSearchBox"),nodeDefStore=useNodeDefStore(),showNewSearchBox=__name(e=>{if(e.detail.subType==="empty-release"){const links=e.detail.linkReleaseContext.links;if(links.length===0){console.warn("Empty release with no links! This should never happen");return}const firstLink=ConnectingLinkImpl.createFromPlainObject(links[0]),filter=nodeDefStore.nodeSearchService.getFilterById(firstLink.releaseSlotType),dataType=firstLink.type.toString();addFilter([filter,dataType])}visible.value=!0,triggerEvent.value=e,dismissable.value=!1,setTimeout(()=>{dismissable.value=!0},300)},"showNewSearchBox"),showContextMenu=__name(e=>{if(e.detail.subType!=="empty-release")return;const links=e.detail.linkReleaseContext.links;if(links.length===0){console.warn("Empty release with no links! This should never happen");return}const firstLink=ConnectingLinkImpl.createFromPlainObject(links[0]),commonOptions={e:e.detail.originalEvent,allow_searchbox:!0,showSearchBox:__name(()=>showSearchBox(e),"showSearchBox")},connectionOptions=firstLink.output?{nodeFrom:firstLink.node,slotFrom:firstLink.output,afterRerouteId:firstLink.afterRerouteId}:{nodeTo:firstLink.node,slotTo:firstLink.input,afterRerouteId:firstLink.afterRerouteId};canvasStore.canvas.showConnectionMenu({...connectionOptions,...commonOptions})},"showContextMenu"),canvasStore=useCanvasStore();watchEffect(()=>{canvasStore.canvas&&(LiteGraph.release_link_on_empty_shows_menu=!1,canvasStore.canvas.allow_searchbox=!1)});const canvasEventHandler=__name(e=>{if(e.detail.subType==="empty-double-click")showSearchBox(e);else if(e.detail.subType==="empty-release")handleCanvasEmptyRelease(e);else if(e.detail.subType==="group-double-click"){const group=e.detail.group,[x,y]=group.pos;e.detail.originalEvent.canvasY-y>group.titleHeight&&showSearchBox(e)}},"canvasEventHandler"),linkReleaseAction=computed(()=>settingStore.get("Comfy.LinkRelease.Action")),linkReleaseActionShift=computed(()=>settingStore.get("Comfy.LinkRelease.ActionShift")),handleCanvasEmptyRelease=__name(e=>{switch(e.detail.originalEvent.shiftKey?linkReleaseActionShift.value:linkReleaseAction.value){case LinkReleaseTriggerAction.SEARCH_BOX:showSearchBox(e);break;case LinkReleaseTriggerAction.CONTEXT_MENU:showContextMenu(e);break;case LinkReleaseTriggerAction.NO_ACTION:default:break}},"handleCanvasEmptyRelease");return useEventListener(document,"litegraph:canvas",canvasEventHandler),(_ctx,_cache)=>(openBlock(),createElementBlock("div",null,[createVNode(unref(script$a),{visible:unref(visible),"onUpdate:visible":_cache[0]||(_cache[0]=$event=>isRef(visible)?visible.value=$event:null),modal:"","dismissable-mask":dismissable.value,onHide:clearFilters,pt:{root:{class:"invisible-dialog-root",role:"search"},mask:{class:"node-search-box-dialog-mask"},transition:{enterFromClass:"opacity-0 scale-75",enterActiveClass:"transition-all duration-100 ease-out",leaveActiveClass:"transition-all duration-100 ease-in",leaveToClass:"opacity-0 scale-75"}}},{container:withCtx(()=>[createVNode(_sfc_main$i,{filters:nodeFilters.value,onAddFilter:addFilter,onRemoveFilter:removeFilter,onAddNode:addNode},null,8,["filters"])]),_:1},8,["visible","dismissable-mask"])]))}}),_sfc_main$g=defineComponent({__name:"SidebarIcon",props:{icon:String,selected:Boolean,tooltip:{type:String,default:""},class:{type:String,default:""},iconBadge:{type:[String,Function],default:""}},emits:["click"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,overlayValue=computed(()=>typeof props.iconBadge=="function"?props.iconBadge()||"":props.iconBadge),shouldShowBadge=computed(()=>!!overlayValue.value);return(_ctx,_cache)=>{const _directive_tooltip=resolveDirective("tooltip");return withDirectives((openBlock(),createBlock(unref(script),{class:normalizeClass(props.class),text:"",pt:{root:{class:`side-bar-button ${props.selected?"p-button-primary side-bar-button-selected":"p-button-secondary"}`,"aria-label":props.tooltip}},onClick:_cache[0]||(_cache[0]=$event=>emit("click",$event))},{icon:withCtx(()=>[shouldShowBadge.value?(openBlock(),createBlock(unref(script$b),{key:0,value:overlayValue.value},{default:withCtx(()=>[createBaseVNode("i",{class:normalizeClass(props.icon+" side-bar-button-icon")},null,2)]),_:1},8,["value"])):(openBlock(),createElementBlock("i",{key:1,class:normalizeClass(props.icon+" side-bar-button-icon")},null,2))]),_:1},8,["class","pt"])),[[_directive_tooltip,{value:props.tooltip,showDelay:300,hideDelay:300}]])}}}),SidebarIcon=_export_sfc(_sfc_main$g,[["__scopeId","data-v-6ab4daa6"]]),_sfc_main$f=defineComponent({__name:"SidebarLogoutIcon",setup(__props){const{t:t2}=useI18n(),userStore=useUserStore(),tooltip=computed(()=>`${t2("sideToolbar.logout")} (${userStore.currentUser?.username})`),logout=__name(()=>{userStore.logout(),window.location.reload()},"logout");return(_ctx,_cache)=>(openBlock(),createBlock(SidebarIcon,{icon:"pi pi-sign-out",tooltip:tooltip.value,onClick:logout},null,8,["tooltip"]))}}),_sfc_main$e=defineComponent({__name:"SidebarSettingsToggleIcon",setup(__props){const dialogStore=useDialogStore(),showSetting=__name(()=>{dialogStore.showDialog({key:"global-settings",headerComponent:SettingDialogHeader,component:SettingDialogContent})},"showSetting");return(_ctx,_cache)=>(openBlock(),createBlock(SidebarIcon,{icon:"pi pi-cog",class:"comfy-settings-btn",onClick:showSetting,tooltip:_ctx.$t("g.settings")},null,8,["tooltip"]))}}),_sfc_main$d=defineComponent({__name:"SidebarThemeToggleIcon",setup(__props){const colorPaletteStore=useColorPaletteStore(),icon=computed(()=>colorPaletteStore.completedActivePalette.light_theme?"pi pi-sun":"pi pi-moon"),commandStore=useCommandStore(),toggleTheme=__name(()=>{commandStore.execute("Comfy.ToggleTheme")},"toggleTheme");return(_ctx,_cache)=>(openBlock(),createBlock(SidebarIcon,{icon:icon.value,onClick:toggleTheme,tooltip:_ctx.$t("sideToolbar.themeToggle"),class:"comfy-vue-theme-toggle"},null,8,["icon","tooltip"]))}}),_hoisted_1$d={class:"side-tool-bar-end"},_hoisted_2$3={key:0,class:"sidebar-content-container h-full overflow-y-auto overflow-x-hidden"},_sfc_main$c=defineComponent({__name:"SideToolbar",setup(__props){const workspaceStore=useWorkspaceStore(),settingStore=useSettingStore(),userStore=useUserStore(),teleportTarget=computed(()=>settingStore.get("Comfy.Sidebar.Location")==="left"?".comfyui-body-left":".comfyui-body-right"),isSmall=computed(()=>settingStore.get("Comfy.Sidebar.Size")==="small"),tabs=computed(()=>workspaceStore.getSidebarTabs()),selectedTab=computed(()=>workspaceStore.sidebarTab.activeSidebarTab),onTabClick=__name(item=>{workspaceStore.sidebarTab.toggleSidebarTab(item.id)},"onTabClick"),keybindingStore=useKeybindingStore(),getTabTooltipSuffix=__name(tab=>{const keybinding=keybindingStore.getKeybindingByCommandId(`Workspace.ToggleSidebarTab.${tab.id}`);return keybinding?` (${keybinding.combo.toString()})`:""},"getTabTooltipSuffix");return(_ctx,_cache)=>(openBlock(),createElementBlock(Fragment,null,[(openBlock(),createBlock(Teleport,{to:teleportTarget.value},[createBaseVNode("nav",{class:normalizeClass(["side-tool-bar-container",{"small-sidebar":isSmall.value}])},[(openBlock(!0),createElementBlock(Fragment,null,renderList(tabs.value,tab=>(openBlock(),createBlock(SidebarIcon,{key:tab.id,icon:tab.icon,iconBadge:tab.iconBadge,tooltip:tab.tooltip+getTabTooltipSuffix(tab),selected:tab.id===selectedTab.value?.id,class:normalizeClass(tab.id+"-tab-button"),onClick:__name($event=>onTabClick(tab),"onClick")},null,8,["icon","iconBadge","tooltip","selected","class","onClick"]))),128)),createBaseVNode("div",_hoisted_1$d,[unref(userStore).isMultiUserServer?(openBlock(),createBlock(_sfc_main$f,{key:0})):createCommentVNode("",!0),createVNode(_sfc_main$d),createVNode(_sfc_main$e)])],2)],8,["to"])),selectedTab.value?(openBlock(),createElementBlock("div",_hoisted_2$3,[createVNode(_sfc_main$q,{extension:selectedTab.value},null,8,["extension"])])):createCommentVNode("",!0)],64))}}),SideToolbar=_export_sfc(_sfc_main$c,[["__scopeId","data-v-33cac83a"]]),_hoisted_1$c={class:"workflow-label text-sm max-w-[150px] truncate inline-block"},_hoisted_2$2={class:"relative"},_hoisted_3$2={key:0,class:"status-indicator"},_sfc_main$b=defineComponent({__name:"WorkflowTab",props:{class:{},workflowOption:{}},setup(__props){const props=__props,workspaceStore=useWorkspaceStore(),workflowStore=useWorkflowStore(),workflowTabRef=ref(null),closeWorkflows=__name(async options=>{for(const opt of options)if(!await useWorkflowService().closeWorkflow(opt.workflow,{warnIfUnsaved:!workspaceStore.shiftDown}))break},"closeWorkflows"),onCloseWorkflow=__name(option=>{closeWorkflows([option])},"onCloseWorkflow"),tabGetter=__name(()=>workflowTabRef.value,"tabGetter");return usePragmaticDraggable(tabGetter,{getInitialData:__name(()=>({workflowKey:props.workflowOption.workflow.key}),"getInitialData")}),usePragmaticDroppable(tabGetter,{getData:__name(()=>({workflowKey:props.workflowOption.workflow.key}),"getData"),onDrop:__name(e=>{const fromIndex=workflowStore.openWorkflows.findIndex(wf=>wf.key===e.source.data.workflowKey),toIndex=workflowStore.openWorkflows.findIndex(wf=>wf.key===e.location.current.dropTargets[0]?.data.workflowKey);fromIndex!==toIndex&&workflowStore.reorderWorkflows(fromIndex,toIndex)},"onDrop")}),(_ctx,_cache)=>{const _directive_tooltip=resolveDirective("tooltip");return openBlock(),createElementBlock("div",mergeProps({class:"flex p-2 gap-2 workflow-tab",ref_key:"workflowTabRef",ref:workflowTabRef},_ctx.$attrs),[withDirectives((openBlock(),createElementBlock("span",_hoisted_1$c,[createTextVNode(toDisplayString(_ctx.workflowOption.workflow.filename),1)])),[[_directive_tooltip,_ctx.workflowOption.workflow.key,void 0,{bottom:!0}]]),createBaseVNode("div",_hoisted_2$2,[!unref(workspaceStore).shiftDown&&(_ctx.workflowOption.workflow.isModified||!_ctx.workflowOption.workflow.isPersisted)?(openBlock(),createElementBlock("span",_hoisted_3$2,"•")):createCommentVNode("",!0),createVNode(unref(script),{class:"close-button p-0 w-auto",icon:"pi pi-times",text:"",severity:"secondary",size:"small",onClick:_cache[0]||(_cache[0]=withModifiers($event=>onCloseWorkflow(_ctx.workflowOption),["stop"]))})])],16)}}}),WorkflowTab=_export_sfc(_sfc_main$b,[["__scopeId","data-v-bbd0e49e"]]),_hoisted_1$b={class:"workflow-tabs-container flex flex-row max-w-full h-full"},_sfc_main$a=defineComponent({__name:"WorkflowTabs",props:{class:{}},setup(__props){const props=__props,{t:t2}=useI18n(),workspaceStore=useWorkspaceStore(),workflowStore=useWorkflowStore(),workflowService=useWorkflowService(),workflowBookmarkStore=useWorkflowBookmarkStore(),rightClickedTab=ref(null),menu=ref(),workflowToOption=__name(workflow=>({value:workflow.path,workflow}),"workflowToOption"),options=computed(()=>workflowStore.openWorkflows.map(workflowToOption)),selectedWorkflow=computed(()=>workflowStore.activeWorkflow?workflowToOption(workflowStore.activeWorkflow):null),onWorkflowChange=__name(option=>{option&&selectedWorkflow.value?.value!==option.value&&workflowService.openWorkflow(option.workflow)},"onWorkflowChange"),closeWorkflows=__name(async options2=>{for(const opt of options2)if(!await workflowService.closeWorkflow(opt.workflow,{warnIfUnsaved:!workspaceStore.shiftDown}))break},"closeWorkflows"),onCloseWorkflow=__name(option=>{closeWorkflows([option])},"onCloseWorkflow"),showContextMenu=__name((event,option)=>{rightClickedTab.value=option,menu.value.show(event)},"showContextMenu"),contextMenuItems=computed(()=>{const tab=rightClickedTab.value;if(!tab)return[];const index=options.value.findIndex(v=>v.workflow===tab.workflow);return[{label:t2("tabMenu.duplicateTab"),command:__name(()=>{workflowService.duplicateWorkflow(tab.workflow)},"command")},{separator:!0},{label:t2("tabMenu.closeTab"),command:__name(()=>onCloseWorkflow(tab),"command")},{label:t2("tabMenu.closeTabsToLeft"),command:__name(()=>closeWorkflows(options.value.slice(0,index)),"command"),disabled:index<=0},{label:t2("tabMenu.closeTabsToRight"),command:__name(()=>closeWorkflows(options.value.slice(index+1)),"command"),disabled:index===options.value.length-1},{label:t2("tabMenu.closeOtherTabs"),command:__name(()=>closeWorkflows([...options.value.slice(index+1),...options.value.slice(0,index)]),"command"),disabled:options.value.length<=1},{label:workflowBookmarkStore.isBookmarked(tab.workflow.path)?t2("tabMenu.removeFromBookmarks"):t2("tabMenu.addToBookmarks"),command:__name(()=>workflowBookmarkStore.toggleBookmarked(tab.workflow.path),"command"),disabled:tab.workflow.isTemporary}]}),commandStore=useCommandStore(),handleWheel=__name(event=>{const scrollElement=event.currentTarget,scrollAmount=event.deltaX||event.deltaY;scrollElement.scroll({left:scrollElement.scrollLeft+scrollAmount})},"handleWheel");return(_ctx,_cache)=>{const _directive_tooltip=resolveDirective("tooltip");return openBlock(),createElementBlock("div",_hoisted_1$b,[createVNode(unref(script$d),{class:"overflow-hidden no-drag","pt:content":{class:"p-0 w-full",onwheel:handleWheel},"pt:barX":"h-1"},{default:withCtx(()=>[createVNode(unref(script$c),{class:normalizeClass(["workflow-tabs bg-transparent",props.class]),modelValue:selectedWorkflow.value,"onUpdate:modelValue":onWorkflowChange,options:options.value,optionLabel:"label",dataKey:"value"},{option:withCtx(({option})=>[createVNode(WorkflowTab,{onContextmenu:__name($event=>showContextMenu($event,option),"onContextmenu"),onMouseup:withModifiers($event=>onCloseWorkflow(option),["middle"]),"workflow-option":option},null,8,["onContextmenu","onMouseup","workflow-option"])]),_:1},8,["class","modelValue","options"])]),_:1},8,["pt:content"]),withDirectives(createVNode(unref(script),{class:"new-blank-workflow-button flex-shrink-0 no-drag",icon:"pi pi-plus",text:"",severity:"secondary","aria-label":_ctx.$t("sideToolbar.newBlankWorkflow"),onClick:_cache[0]||(_cache[0]=()=>unref(commandStore).execute("Comfy.NewBlankWorkflow"))},null,8,["aria-label"]),[[_directive_tooltip,{value:_ctx.$t("sideToolbar.newBlankWorkflow"),showDelay:300}]]),createVNode(unref(script$e),{ref_key:"menu",ref:menu,model:contextMenuItems.value},null,8,["model"])])}}}),WorkflowTabs=_export_sfc(_sfc_main$a,[["__scopeId","data-v-54fadc45"]]),_hoisted_1$a={class:"absolute top-0 left-0 w-auto max-w-full pointer-events-auto"},_sfc_main$9=defineComponent({__name:"SecondRowWorkflowTabs",setup(__props){return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$a,[createVNode(WorkflowTabs)]))}}),SecondRowWorkflowTabs=_export_sfc(_sfc_main$9,[["__scopeId","data-v-38831d8e"]]),useCanvasDrop=__name(canvasRef=>{const modelToNodeStore=useModelToNodeStore(),litegraphService=useLitegraphService(),workflowService=useWorkflowService();usePragmaticDroppable(()=>canvasRef.value,{getDropEffect:__name(args=>args.source.data.type==="tree-explorer-node"?"copy":"move","getDropEffect"),onDrop:__name(event=>{const loc=event.location.current.input,dndData=event.source.data;if(dndData.type==="tree-explorer-node"){const node=dndData.data;if(node.data instanceof ComfyNodeDefImpl){const nodeDef=node.data,pos=app.clientPosToCanvasPos([loc.clientX,loc.clientY+LiteGraph.NODE_TITLE_HEIGHT]);litegraphService.addNodeOnGraph(nodeDef,{pos})}else if(node.data instanceof ComfyModelDef){const model=node.data,pos=app.clientPosToCanvasPos([loc.clientX,loc.clientY]),nodeAtPos=app.graph.getNodeOnPos(pos[0],pos[1]);let targetProvider=null,targetGraphNode=null;if(nodeAtPos){const providers=modelToNodeStore.getAllNodeProviders(model.directory);for(const provider of providers)provider.nodeDef.name===nodeAtPos.comfyClass&&(targetGraphNode=nodeAtPos,targetProvider=provider)}if(!targetGraphNode){const provider=modelToNodeStore.getNodeProvider(model.directory);provider&&(targetGraphNode=litegraphService.addNodeOnGraph(provider.nodeDef,{pos}),targetProvider=provider)}if(targetGraphNode){const widget=targetGraphNode.widgets?.find(widget2=>widget2.name===targetProvider?.key);widget&&(widget.value=model.file_name)}}else if(node.data instanceof ComfyWorkflow){const workflow=node.data,position=app.clientPosToCanvasPos([loc.clientX,loc.clientY]);workflowService.insertWorkflow(workflow,{position})}}},"onDrop")})},"useCanvasDrop"),useContextMenuTranslation=__name(()=>{const f=LGraphCanvas.prototype.getCanvasMenuOptions,getCanvasCenterMenuOptions=__name(function(...args){const res=f.apply(this,args);for(const item of res)item?.content&&(item.content=st(`contextMenu.${item.content}`,item.content));return res},"getCanvasCenterMenuOptions");LGraphCanvas.prototype.getCanvasMenuOptions=getCanvasCenterMenuOptions;function translateMenus(values,options){if(!values)return;const reInput=/Convert (.*) to input/,reWidget=/Convert (.*) to widget/,cvt=st("contextMenu.Convert ","Convert "),tinp=st("contextMenu. to input"," to input"),twgt=st("contextMenu. to widget"," to widget");for(const value of values){if(typeof value=="string"||(translateMenus(value?.submenu?.options,options),!value?.content))continue;te(`contextMenu.${value.content}`)&&(value.content=st(`contextMenu.${value.content}`,value.content));const extraInfo=options.extra||options.parentMenu?.options?.extra,matchInput=value.content?.match(reInput);if(matchInput){let match=matchInput[1];extraInfo?.inputs?.find(i=>{if(i.name!=match)return!1;match=i.label?i.label:i.name}),extraInfo?.widgets?.find(i=>{if(i.name!=match)return!1;match=i.label?i.label:i.name}),value.content=cvt+match+tinp;continue}const matchWidget=value.content?.match(reWidget);if(matchWidget){let match=matchWidget[1];extraInfo?.inputs?.find(i=>{if(i.name!=match)return!1;match=i.label?i.label:i.name}),extraInfo?.widgets?.find(i=>{if(i.name!=match)return!1;match=i.label?i.label:i.name}),value.content=cvt+match+twgt;continue}}}__name(translateMenus,"translateMenus");const OriginalContextMenu=LiteGraph.ContextMenu;function ContextMenu2(values,options){return options.title&&(options.title=st(`nodeDefs.${normalizeI18nKey(options.title)}.display_name`,options.title)),translateMenus(values,options),new OriginalContextMenu(values,options)}__name(ContextMenu2,"ContextMenu"),LiteGraph.ContextMenu=ContextMenu2},"useContextMenuTranslation"),useCopy=__name(()=>{const canvasStore=useCanvasStore();useEventListener(document,"copy",e=>{if(!(e.target instanceof Element)||e.target instanceof HTMLTextAreaElement&&e.target.type==="textarea"||e.target instanceof HTMLInputElement&&e.target.type==="text")return;const isTargetInGraph=e.target.classList.contains("litegraph")||e.target.classList.contains("graph-canvas-container")||e.target.id==="graph-canvas",canvas=canvasStore.canvas;if(isTargetInGraph&&canvas?.selectedItems)return canvas.copyToClipboard(),e.clipboardData?.setData("text"," "),e.preventDefault(),e.stopImmediatePropagation(),!1})},"useCopy"),useGlobalLitegraph=__name(()=>{window.LiteGraph=LiteGraph,window.LGraph=LGraph,window.LLink=LLink,window.LGraphNode=LGraphNode,window.LGraphGroup=LGraphGroup,window.DragAndScale=DragAndScale,window.LGraphCanvas=LGraphCanvas,window.ContextMenu=ContextMenu,window.LGraphBadge=LGraphBadge},"useGlobalLitegraph"),useLitegraphSettings=__name(()=>{const settingStore=useSettingStore(),canvasStore=useCanvasStore();watchEffect(()=>{const canvasInfoEnabled=settingStore.get("Comfy.Graph.CanvasInfo");canvasStore.canvas&&(canvasStore.canvas.show_info=canvasInfoEnabled)}),watchEffect(()=>{const zoomSpeed=settingStore.get("Comfy.Graph.ZoomSpeed");canvasStore.canvas&&(canvasStore.canvas.zoom_speed=zoomSpeed)}),watchEffect(()=>{LiteGraph.snaps_for_comfy=settingStore.get("Comfy.Node.AutoSnapLinkToSlot")}),watchEffect(()=>{LiteGraph.snap_highlights_node=settingStore.get("Comfy.Node.SnapHighlightsNode")}),watchEffect(()=>{LGraphNode.keepAllLinksOnBypass=settingStore.get("Comfy.Node.BypassAllLinksOnDelete")}),watchEffect(()=>{LiteGraph.middle_click_slot_add_default_node=settingStore.get("Comfy.Node.MiddleClickRerouteNode")}),watchEffect(()=>{const linkRenderMode=settingStore.get("Comfy.LinkRenderMode");canvasStore.canvas&&(canvasStore.canvas.links_render_mode=linkRenderMode,canvasStore.canvas.setDirty(!1,!0))}),watchEffect(()=>{const lowQualityRenderingZoomThreshold=settingStore.get("LiteGraph.Canvas.LowQualityRenderingZoomThreshold");canvasStore.canvas&&(canvasStore.canvas.low_quality_zoom_threshold=lowQualityRenderingZoomThreshold,canvasStore.canvas.setDirty(!0,!0))}),watchEffect(()=>{const linkMarkerShape=settingStore.get("Comfy.Graph.LinkMarkers"),{canvas}=canvasStore;canvas&&(canvas.linkMarkerShape=linkMarkerShape,canvas.setDirty(!1,!0))}),watchEffect(()=>{const reroutesEnabled=settingStore.get("Comfy.RerouteBeta"),{canvas}=canvasStore;canvas&&(canvas.reroutesEnabled=reroutesEnabled,canvas.setDirty(!1,!0))}),watchEffect(()=>{const maximumFps=settingStore.get("LiteGraph.Canvas.MaximumFps"),{canvas}=canvasStore;canvas&&(canvas.maximumFps=maximumFps)}),watchEffect(()=>{const dragZoomEnabled=settingStore.get("Comfy.Graph.CtrlShiftZoom"),{canvas}=canvasStore;canvas&&(canvas.dragZoomEnabled=dragZoomEnabled)}),watchEffect(()=>{CanvasPointer.doubleClickTime=settingStore.get("Comfy.Pointer.DoubleClickTime")}),watchEffect(()=>{CanvasPointer.bufferTime=settingStore.get("Comfy.Pointer.ClickBufferTime")}),watchEffect(()=>{CanvasPointer.maxClickDrift=settingStore.get("Comfy.Pointer.ClickDrift")}),watchEffect(()=>{LiteGraph.CANVAS_GRID_SIZE=settingStore.get("Comfy.SnapToGrid.GridSize")}),watchEffect(()=>{LiteGraph.alwaysSnapToGrid=settingStore.get("pysssss.SnapToGrid")}),watchEffect(()=>{LiteGraph.context_menu_scaling=settingStore.get("LiteGraph.ContextMenu.Scaling")})},"useLitegraphSettings"),usePaste=__name(()=>{const workspaceStore=useWorkspaceStore(),canvasStore=useCanvasStore();useEventListener(document,"paste",async e=>{if(workspaceStore.shiftDown)return;const canvas=canvasStore.canvas;if(!canvas)return;const graph=canvas.graph;let data=e.clipboardData||window.clipboardData;const items=data.items;for(const item of items)if(item.type.startsWith("image/")){let imageNode=null;const currentNode=canvas.current_node;if(currentNode&&currentNode.is_selected&&isImageNode(currentNode)&&(imageNode=currentNode),!imageNode){const newNode=LiteGraph.createNode("LoadImage");newNode.pos=[...canvas.graph_mouse],imageNode=graph.add(newNode)??null,graph.change()}const blob=item.getAsFile();imageNode?.pasteFile?.(blob);return}data=data.getData("text/plain");let workflow=null;try{data=data.slice(data.indexOf("{")),workflow=JSON.parse(data)}catch{try{data=data.slice(data.indexOf(`workflow
`)),data=data.slice(data.indexOf("{")),workflow=JSON.parse(data)}catch{workflow=null}}if(workflow&&workflow.version&&workflow.nodes&&workflow.extra)await app.loadGraphData(workflow);else{if(e.target instanceof HTMLTextAreaElement&&e.target.type==="textarea"||e.target instanceof HTMLInputElement&&e.target.type==="text")return;canvas.pasteFromClipboard()}})},"usePaste");function useWorkflowPersistence(){const workflowStore=useWorkflowStore(),settingStore=useSettingStore(),persistCurrentWorkflow=__name(async()=>{const workflow=JSON.stringify(app.serializeGraph());if(localStorage.setItem("workflow",workflow),api.clientId&&sessionStorage.setItem(`workflow:${api.clientId}`,workflow),isEmbedded()){const p=await app.graphToPrompt(),json=JSON.stringify(p.output,null,2);window.parent.postMessage({flowId:FlowConfig.flowId,type:"change",workflow,workflowApi:json},"*")}},"persistCurrentWorkflow"),loadWorkflowFromStorage=__name(async(json,workflowName)=>{if(!json)return!1;const workflow=JSON.parse(json);return await app.loadGraphData(workflow,!0,!0,workflowName),!0},"loadWorkflowFromStorage"),loadPreviousWorkflowFromStorage=__name(async()=>{const workflowName=getStorageValue("Comfy.PreviousWorkflow"),clientId=api.initialClientId??api.clientId;if(clientId){const sessionWorkflow=sessionStorage.getItem(`workflow:${clientId}`);if(await loadWorkflowFromStorage(sessionWorkflow,workflowName))return!0}const localWorkflow=localStorage.getItem("workflow");return await loadWorkflowFromStorage(localWorkflow,workflowName)},"loadPreviousWorkflowFromStorage"),loadDefaultWorkflow=__name(async()=>{settingStore.get("Comfy.TutorialCompleted")?await app.loadGraphData():(await settingStore.set("Comfy.TutorialCompleted",!0),await useModelStore().loadModelFolders(),await useWorkflowService().loadTutorialWorkflow())},"loadDefaultWorkflow"),restorePreviousWorkflow=__name(async()=>{try{await loadPreviousWorkflowFromStorage()||await loadDefaultWorkflow()}catch(err){console.error("Error loading previous workflow",err),await loadDefaultWorkflow()}},"restorePreviousWorkflow");watchEffect(()=>{if(workflowStore.activeWorkflow){const workflow=workflowStore.activeWorkflow;setStorageValue("Comfy.PreviousWorkflow",workflow.key),persistCurrentWorkflow()}}),api.addEventListener("graphChanged",persistCurrentWorkflow);const openWorkflows=computed(()=>workflowStore.openWorkflows),activeWorkflow=computed(()=>workflowStore.activeWorkflow),restoreState=computed(()=>{if(!openWorkflows.value||!activeWorkflow.value)return{paths:[],activeIndex:-1};const paths=openWorkflows.value.filter(workflow=>workflow?.isPersisted&&!workflow.isModified).map(workflow=>workflow.path),activeIndex=openWorkflows.value.findIndex(workflow=>workflow.path===activeWorkflow.value?.path);return{paths,activeIndex}}),storedWorkflows=JSON.parse(getStorageValue("Comfy.OpenWorkflowsPaths")||"[]"),storedActiveIndex=JSON.parse(getStorageValue("Comfy.ActiveWorkflowIndex")||"-1");return watch(restoreState,({paths,activeIndex})=>{setStorageValue("Comfy.OpenWorkflowsPaths",JSON.stringify(paths)),setStorageValue("Comfy.ActiveWorkflowIndex",JSON.stringify(activeIndex))}),{restorePreviousWorkflow,restoreWorkflowTabsState:__name(()=>{storedWorkflows?.length>0&&storedActiveIndex>=0&&workflowStore.openWorkflowsInBackground({left:storedWorkflows.slice(0,storedActiveIndex),right:storedWorkflows.slice(storedActiveIndex)})},"restoreWorkflowTabsState")}}__name(useWorkflowPersistence,"useWorkflowPersistence");const CORE_SETTINGS=[{id:"Comfy.Validation.Workflows",name:"Validate workflows",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl",category:["Comfy","Node Search Box","Implementation"],experimental:!0,name:"Node search box implementation",type:"combo",options:["default","litegraph (legacy)"],defaultValue:"default"},{id:"Comfy.LinkRelease.Action",category:["LiteGraph","LinkRelease","Action"],name:"Action on link release (No modifier)",type:"combo",options:Object.values(LinkReleaseTriggerAction),defaultValue:LinkReleaseTriggerAction.CONTEXT_MENU},{id:"Comfy.LinkRelease.ActionShift",category:["LiteGraph","LinkRelease","ActionShift"],name:"Action on link release (Shift)",type:"combo",options:Object.values(LinkReleaseTriggerAction),defaultValue:LinkReleaseTriggerAction.SEARCH_BOX},{id:"Comfy.NodeSearchBoxImpl.NodePreview",category:["Comfy","Node Search Box","NodePreview"],name:"Node preview",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl.ShowCategory",category:["Comfy","Node Search Box","ShowCategory"],name:"Show node category in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl.ShowIdName",category:["Comfy","Node Search Box","ShowIdName"],name:"Show node id name in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!1},{id:"Comfy.NodeSearchBoxImpl.ShowNodeFrequency",category:["Comfy","Node Search Box","ShowNodeFrequency"],name:"Show node frequency in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!1},{id:"Comfy.Sidebar.Location",category:["Appearance","Sidebar","Location"],name:"Sidebar location",type:"combo",options:["left","right"],defaultValue:"left"},{id:"Comfy.Sidebar.Size",category:["Appearance","Sidebar","Size"],name:"Sidebar size",type:"combo",options:["normal","small"],defaultValue:__name(()=>window.innerWidth<1536?"small":"normal","defaultValue")},{id:"Comfy.TextareaWidget.FontSize",category:["Appearance","Node Widget","TextareaWidget","FontSize"],name:"Textarea widget font size",type:"slider",defaultValue:10,attrs:{min:8,max:24}},{id:"Comfy.TextareaWidget.Spellcheck",category:["Comfy","Node Widget","TextareaWidget","Spellcheck"],name:"Textarea widget spellcheck",type:"boolean",defaultValue:!1},{id:"Comfy.Workflow.SortNodeIdOnSave",name:"Sort node IDs when saving workflow",type:"boolean",defaultValue:!1},{id:"Comfy.Graph.CanvasInfo",category:["LiteGraph","Canvas","CanvasInfo"],name:"Show canvas info on bottom left corner (fps, etc.)",type:"boolean",defaultValue:!0},{id:"Comfy.Node.ShowDeprecated",name:"Show deprecated nodes in search",tooltip:"Deprecated nodes are hidden by default in the UI, but remain functional in existing workflows that use them.",type:"boolean",defaultValue:!1},{id:"Comfy.Node.ShowExperimental",name:"Show experimental nodes in search",tooltip:"Experimental nodes are marked as such in the UI and may be subject to significant changes or removal in future versions. Use with caution in production workflows",type:"boolean",defaultValue:!0},{id:"Comfy.Node.Opacity",category:["Appearance","Node","Opacity"],name:"Node opacity",type:"slider",defaultValue:1,attrs:{min:.01,max:1,step:.01}},{id:"Comfy.Workflow.ShowMissingNodesWarning",name:"Show missing nodes warning",type:"boolean",defaultValue:!0},{id:"Comfy.Workflow.ShowMissingModelsWarning",name:"Show missing models warning",type:"boolean",defaultValue:!0,experimental:!0},{id:"Comfy.Graph.ZoomSpeed",category:["LiteGraph","Canvas","ZoomSpeed"],name:"Canvas zoom speed",type:"slider",defaultValue:1.1,attrs:{min:1.01,max:2.5,step:.01}},{id:"Comfy.NodeLibrary.Bookmarks",name:"Node library bookmarks with display name (deprecated)",type:"hidden",defaultValue:[],deprecated:!0},{id:"Comfy.NodeLibrary.Bookmarks.V2",name:"Node library bookmarks v2 with unique name",type:"hidden",defaultValue:[]},{id:"Comfy.NodeLibrary.BookmarksCustomization",name:"Node library bookmarks customization",type:"hidden",defaultValue:{}},{id:"Comfy.Queue.ImageFit",name:"Queue image fit",type:"hidden",defaultValue:"cover"},{id:"Comfy.GroupSelectedNodes.Padding",category:["LiteGraph","Group","Padding"],name:"Group selected nodes padding",type:"slider",defaultValue:10,attrs:{min:0,max:100}},{id:"Comfy.Node.DoubleClickTitleToEdit",category:["LiteGraph","Node","DoubleClickTitleToEdit"],name:"Double click node title to edit",type:"boolean",defaultValue:!0},{id:"Comfy.Group.DoubleClickTitleToEdit",category:["LiteGraph","Group","DoubleClickTitleToEdit"],name:"Double click group title to edit",type:"boolean",defaultValue:!0},{id:"Comfy.Window.UnloadConfirmation",name:"Show confirmation when closing window",type:"boolean",defaultValue:!0,versionModified:"1.7.12"},{id:"Comfy.TreeExplorer.ItemPadding",category:["Appearance","Tree Explorer","ItemPadding"],name:"Tree explorer item padding",type:"slider",defaultValue:2,attrs:{min:0,max:8,step:1}},{id:"Comfy.ModelLibrary.AutoLoadAll",name:"Automatically load all model folders",tooltip:"If true, all folders will load as soon as you open the model library (this may cause delays while it loads). If false, root level model folders will only load once you click on them.",type:"boolean",defaultValue:!1},{id:"Comfy.ModelLibrary.NameFormat",name:"What name to display in the model library tree view",tooltip:'Select "filename" to render a simplified view of the raw filename (without directory or ".safetensors" extension) in the model list. Select "title" to display the configurable model metadata title.',type:"combo",options:["filename","title"],defaultValue:"title"},{id:"Comfy.Locale",name:"Language",type:"combo",options:[{value:"en",text:"English"},{value:"zh",text:"中文"},{value:"ru",text:"Русский"},{value:"ja",text:"日本語"},{value:"ko",text:"한국어"},{value:"fr",text:"Français"}],defaultValue:__name(()=>navigator.language.split("-")[0]||"en","defaultValue")},{id:"Comfy.NodeBadge.NodeSourceBadgeMode",category:["LiteGraph","Node","NodeSourceBadgeMode"],name:"Node source badge mode",type:"combo",options:Object.values(NodeBadgeMode),defaultValue:NodeBadgeMode.HideBuiltIn},{id:"Comfy.NodeBadge.NodeIdBadgeMode",category:["LiteGraph","Node","NodeIdBadgeMode"],name:"Node ID badge mode",type:"combo",options:[NodeBadgeMode.None,NodeBadgeMode.ShowAll],defaultValue:NodeBadgeMode.None},{id:"Comfy.NodeBadge.NodeLifeCycleBadgeMode",category:["LiteGraph","Node","NodeLifeCycleBadgeMode"],name:"Node life cycle badge mode",type:"combo",options:[NodeBadgeMode.None,NodeBadgeMode.ShowAll],defaultValue:NodeBadgeMode.ShowAll},{id:"Comfy.ConfirmClear",category:["Comfy","Workflow","ConfirmClear"],name:"Require confirmation when clearing workflow",type:"boolean",defaultValue:!0},{id:"Comfy.PromptFilename",category:["Comfy","Workflow","PromptFilename"],name:"Prompt for filename when saving workflow",type:"boolean",defaultValue:!0},{id:"Comfy.PreviewFormat",category:["LiteGraph","Node Widget","PreviewFormat"],name:"Preview image format",tooltip:"When displaying a preview in the image widget, convert it to a lightweight image, e.g. webp, jpeg, webp;50, etc.",type:"text",defaultValue:""},{id:"Comfy.DisableSliders",category:["LiteGraph","Node Widget","DisableSliders"],name:"Disable node widget sliders",type:"boolean",defaultValue:!1},{id:"Comfy.DisableFloatRounding",category:["LiteGraph","Node Widget","DisableFloatRounding"],name:"Disable default float widget rounding.",tooltip:"(requires page reload) Cannot disable round when round is set by the node in the backend.",type:"boolean",defaultValue:!1},{id:"Comfy.FloatRoundingPrecision",category:["LiteGraph","Node Widget","FloatRoundingPrecision"],name:"Float widget rounding decimal places [0 = auto].",tooltip:"(requires page reload)",type:"slider",attrs:{min:0,max:6,step:1},defaultValue:0},{id:"LiteGraph.Node.TooltipDelay",name:"Tooltip Delay",type:"number",attrs:{min:100,max:3e3,step:50},defaultValue:500,versionAdded:"1.9.0"},{id:"Comfy.EnableTooltips",category:["LiteGraph","Node","EnableTooltips"],name:"Enable Tooltips",type:"boolean",defaultValue:!0},{id:"Comfy.DevMode",name:"Enable dev mode options (API save, etc.)",type:"boolean",defaultValue:!1,onChange:__name(value=>{const element=document.getElementById("comfy-dev-save-api-button");element&&(element.style.display=value?"flex":"none")},"onChange")},{id:"Comfy.UseNewMenu",category:["Comfy","Menu","UseNewMenu"],defaultValue:"Top",name:"Use new menu",type:"combo",options:["Disabled","Top","Bottom"],migrateDeprecatedValue:__name(value=>value==="Floating"?"Top":value,"migrateDeprecatedValue")},{id:"Comfy.Workflow.WorkflowTabsPosition",name:"Opened workflows position",type:"combo",options:["Sidebar","Topbar","Topbar (2nd-row)"],defaultValue:__name(()=>window.innerWidth<1536?"Topbar (2nd-row)":"Topbar","defaultValue")},{id:"Comfy.Graph.CanvasMenu",category:["LiteGraph","Canvas","CanvasMenu"],name:"Show graph canvas menu",type:"boolean",defaultValue:!0},{id:"Comfy.QueueButton.BatchCountLimit",name:"Batch count limit",tooltip:"The maximum number of tasks added to the queue at one button click",type:"number",defaultValue:100,versionAdded:"1.3.5"},{id:"Comfy.Keybinding.UnsetBindings",name:"Keybindings unset by the user",type:"hidden",defaultValue:[],versionAdded:"1.3.7",versionModified:"1.7.3",migrateDeprecatedValue:__name(value=>value.map(keybinding=>(keybinding.targetSelector==="#graph-canvas"&&(keybinding.targetElementId="graph-canvas"),keybinding)),"migrateDeprecatedValue")},{id:"Comfy.Keybinding.NewBindings",name:"Keybindings set by the user",type:"hidden",defaultValue:[],versionAdded:"1.3.7"},{id:"Comfy.Extension.Disabled",name:"Disabled extension names",type:"hidden",defaultValue:[],versionAdded:"1.3.11"},{id:"Comfy.Validation.NodeDefs",name:"Validate node definitions (slow)",type:"boolean",tooltip:"Recommended for node developers. This will validate all node definitions on startup.",defaultValue:!1,versionAdded:"1.3.14"},{id:"Comfy.LinkRenderMode",category:["LiteGraph","Graph","LinkRenderMode"],name:"Link Render Mode",defaultValue:2,type:"combo",options:[{value:LiteGraph.STRAIGHT_LINK,text:"Straight"},{value:LiteGraph.LINEAR_LINK,text:"Linear"},{value:LiteGraph.SPLINE_LINK,text:"Spline"},{value:LiteGraph.HIDDEN_LINK,text:"Hidden"}]},{id:"Comfy.Node.AutoSnapLinkToSlot",category:["LiteGraph","Node","AutoSnapLinkToSlot"],name:"Auto snap link to node slot",tooltip:"When dragging a link over a node, the link automatically snap to a viable input slot on the node",type:"boolean",defaultValue:!0,versionAdded:"1.3.29"},{id:"Comfy.Node.SnapHighlightsNode",category:["LiteGraph","Node","SnapHighlightsNode"],name:"Snap highlights node",tooltip:"When dragging a link over a node with viable input slot, highlight the node",type:"boolean",defaultValue:!0,versionAdded:"1.3.29"},{id:"Comfy.Node.BypassAllLinksOnDelete",category:["LiteGraph","Node","BypassAllLinksOnDelete"],name:"Keep all links when deleting nodes",tooltip:"When deleting a node, attempt to reconnect all of its input and output links (bypassing the deleted node)",type:"boolean",defaultValue:!0,versionAdded:"1.3.40"},{id:"Comfy.Node.MiddleClickRerouteNode",category:["LiteGraph","Node","MiddleClickRerouteNode"],name:"Middle-click creates a new Reroute node",type:"boolean",defaultValue:!0,versionAdded:"1.3.42"},{id:"Comfy.RerouteBeta",category:["LiteGraph","RerouteBeta"],name:"Opt-in to the reroute beta test",tooltip:`Enables the new native reroutes.

Reroutes can be added by holding alt and dragging from a link line, or on the link menu.

Disabling this option is non-destructive - reroutes are hidden.`,experimental:!0,type:"boolean",defaultValue:!1,versionAdded:"1.3.42"},{id:"Comfy.Graph.LinkMarkers",category:["LiteGraph","Link","LinkMarkers"],name:"Link midpoint markers",defaultValue:LinkMarkerShape.Circle,type:"combo",options:[{value:LinkMarkerShape.None,text:"None"},{value:LinkMarkerShape.Circle,text:"Circle"},{value:LinkMarkerShape.Arrow,text:"Arrow"}],versionAdded:"1.3.42"},{id:"Comfy.DOMClippingEnabled",category:["LiteGraph","Node","DOMClippingEnabled"],name:"Enable DOM element clipping (enabling may reduce performance)",type:"boolean",defaultValue:!0},{id:"Comfy.Graph.CtrlShiftZoom",category:["LiteGraph","Canvas","CtrlShiftZoom"],name:"Enable fast-zoom shortcut (Ctrl + Shift + Drag)",type:"boolean",defaultValue:!0,versionAdded:"1.4.0"},{id:"Comfy.Pointer.ClickDrift",category:["LiteGraph","Pointer","ClickDrift"],name:"Pointer click drift (maximum distance)",tooltip:`If the pointer moves more than this distance while holding a button down, it is considered dragging (rather than clicking).

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`,experimental:!0,type:"slider",attrs:{min:0,max:20,step:1},defaultValue:6,versionAdded:"1.4.3"},{id:"Comfy.Pointer.ClickBufferTime",category:["LiteGraph","Pointer","ClickBufferTime"],name:"Pointer click drift delay",tooltip:`After pressing a pointer button down, this is the maximum time (in milliseconds) that pointer movement can be ignored for.

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`,experimental:!0,type:"slider",attrs:{min:0,max:1e3,step:25},defaultValue:150,versionAdded:"1.4.3"},{id:"Comfy.Pointer.DoubleClickTime",category:["LiteGraph","Pointer","DoubleClickTime"],name:"Double click interval (maximum)",tooltip:"The maximum time in milliseconds between the two clicks of a double-click.  Increasing this value may assist if double-clicks are sometimes not registered.",type:"slider",attrs:{min:100,max:1e3,step:50},defaultValue:300,versionAdded:"1.4.3"},{id:"Comfy.SnapToGrid.GridSize",category:["LiteGraph","Canvas","GridSize"],name:"Snap to grid size",type:"slider",attrs:{min:1,max:500},tooltip:"When dragging and resizing nodes while holding shift they will be aligned to the grid, this controls the size of that grid.",defaultValue:LiteGraph.CANVAS_GRID_SIZE},{id:"pysssss.SnapToGrid",category:["LiteGraph","Canvas","AlwaysSnapToGrid"],name:"Always snap to grid",type:"boolean",defaultValue:!1,versionAdded:"1.3.13"},{id:"Comfy.Server.ServerConfigValues",name:"Server config values for frontend display",tooltip:"Server config values used for frontend display only",type:"hidden",defaultValue:{},versionAdded:"1.4.8"},{id:"Comfy.Server.LaunchArgs",name:"Server launch arguments",tooltip:"These are the actual arguments that are passed to the server when it is launched.",type:"hidden",defaultValue:{},versionAdded:"1.4.8"},{id:"Comfy.Queue.MaxHistoryItems",name:"Queue history size",tooltip:"The maximum number of tasks that show in the queue history.",type:"slider",attrs:{min:16,max:256,step:16},defaultValue:64,versionAdded:"1.4.12"},{id:"LiteGraph.Canvas.MaximumFps",name:"Maximum FPS",tooltip:"The maximum frames per second that the canvas is allowed to render. Caps GPU usage at the cost of smoothness. If 0, the screen refresh rate is used. Default: 0",type:"slider",attrs:{min:0,max:120},defaultValue:0,versionAdded:"1.5.1"},{id:"Comfy.EnableWorkflowViewRestore",category:["Comfy","Workflow","EnableWorkflowViewRestore"],name:"Save and restore canvas position and zoom level in workflows",type:"boolean",defaultValue:!0,versionModified:"1.5.4"},{id:"Comfy.Workflow.ConfirmDelete",name:"Show confirmation when deleting workflows",type:"boolean",defaultValue:!0,versionAdded:"1.5.6"},{id:"Comfy.ColorPalette",name:"The active color palette id",type:"hidden",defaultValue:"dark",versionModified:"1.6.7",migrateDeprecatedValue(value){return value.startsWith("custom_")?value.replace("custom_",""):value}},{id:"Comfy.CustomColorPalettes",name:"Custom color palettes",type:"hidden",defaultValue:{},versionModified:"1.6.7"},{id:"Comfy.WidgetControlMode",category:["Comfy","Node Widget","WidgetControlMode"],name:"Widget control mode",tooltip:"Controls when widget values are updated (randomize/increment/decrement), either before the prompt is queued or after.",type:"combo",defaultValue:"after",options:["before","after"],versionModified:"1.6.10"},{id:"Comfy.TutorialCompleted",name:"Tutorial completed",type:"hidden",defaultValue:!1,versionAdded:"1.8.7"},{id:"LiteGraph.ContextMenu.Scaling",name:"Scale node combo widget menus (lists) when zoomed in",defaultValue:!1,type:"boolean",versionAdded:"1.8.8"},{id:"LiteGraph.Canvas.LowQualityRenderingZoomThreshold",name:"Low quality rendering zoom threshold",tooltip:"Render low quality shapes when zoomed out",type:"slider",attrs:{min:.1,max:1,step:.01},defaultValue:.6,versionAdded:"1.9.1"}],_sfc_main$8=defineComponent({__name:"GraphCanvas",emits:["ready"],setup(__props,{emit:__emit}){const emit=__emit,canvasRef=ref(null),settingStore=useSettingStore(),nodeDefStore=useNodeDefStore(),workspaceStore=useWorkspaceStore(),canvasStore=useCanvasStore(),betaMenuEnabled=computed(()=>settingStore.get("Comfy.UseNewMenu")!=="Disabled"),workflowTabsPosition=computed(()=>settingStore.get("Comfy.Workflow.WorkflowTabsPosition")),canvasMenuEnabled=computed(()=>settingStore.get("Comfy.Graph.CanvasMenu")),tooltipEnabled=computed(()=>settingStore.get("Comfy.EnableTooltips"));watchEffect(()=>{nodeDefStore.showDeprecated=settingStore.get("Comfy.Node.ShowDeprecated")}),watchEffect(()=>{nodeDefStore.showExperimental=settingStore.get("Comfy.Node.ShowExperimental")}),watchEffect(()=>{const spellcheckEnabled=settingStore.get("Comfy.TextareaWidget.Spellcheck");document.querySelectorAll("textarea.comfy-multiline-input").forEach(textarea=>{textarea.spellcheck=spellcheckEnabled,textarea.focus(),textarea.blur()})}),watch(()=>settingStore.get("Comfy.WidgetControlMode"),()=>{if(canvasStore.canvas){for(const n of app.graph.nodes)if(n.widgets){for(const w of n.widgets)if(w[IS_CONTROL_WIDGET]&&(updateControlWidgetLabel(w),w.linkedWidgets))for(const l of w.linkedWidgets)updateControlWidgetLabel(l)}app.graph.setDirtyCanvas(!0)}});const colorPaletteService=useColorPaletteService(),colorPaletteStore=useColorPaletteStore();watch([()=>canvasStore.canvas,()=>settingStore.get("Comfy.ColorPalette")],([canvas,currentPaletteId])=>{canvas&&colorPaletteService.loadColorPalette(currentPaletteId)}),watch(()=>colorPaletteStore.activePaletteId,newValue=>{settingStore.set("Comfy.ColorPalette",newValue)});const loadCustomNodesI18n=__name(async()=>{try{const i18nData=await api.getCustomNodesI18n();Object.entries(i18nData).forEach(([locale,message])=>{i18n.global.mergeLocaleMessage(locale,message)})}catch(error){console.error("Failed to load custom nodes i18n",error)}},"loadCustomNodesI18n"),comfyAppReady=ref(!1),workflowPersistence=useWorkflowPersistence();return useCanvasDrop(canvasRef),useLitegraphSettings(),onMounted(async()=>{useGlobalLitegraph(),useContextMenuTranslation(),useCopy(),usePaste(),app.vueAppReady=!0,workspaceStore.spinner=!0,ChangeTracker.init(app),await loadCustomNodesI18n(),await settingStore.loadSettingValues(),CORE_SETTINGS.forEach(setting=>{settingStore.addSetting(setting)}),await app.setup(canvasRef.value),canvasStore.canvas=app.canvas,canvasStore.canvas.render_canvas_border=!1,workspaceStore.spinner=!1,window.app=app,window.graph=app.graph,comfyAppReady.value=!0,colorPaletteStore.customPalettes=settingStore.get("Comfy.CustomColorPalettes"),await workflowPersistence.restorePreviousWorkflow(),workflowPersistence.restoreWorkflowTabsState(),watch(()=>settingStore.get("Comfy.Locale"),async()=>{await useCommandStore().execute("Comfy.RefreshNodeDefinitions"),useWorkflowService().reloadCurrentWorkflow()}),emit("ready")}),(_ctx,_cache)=>(openBlock(),createElementBlock(Fragment,null,[(openBlock(),createBlock(Teleport,{to:".graph-canvas-container"},[comfyAppReady.value&&betaMenuEnabled.value&&!unref(workspaceStore).focusMode?(openBlock(),createBlock(LiteGraphCanvasSplitterOverlay,{key:0},createSlots({"bottom-panel":withCtx(()=>[createVNode(_sfc_main$p)]),"graph-canvas-panel":withCtx(()=>[workflowTabsPosition.value==="Topbar (2nd-row)"&&!unref(isEmbedded)()?(openBlock(),createBlock(SecondRowWorkflowTabs,{key:0})):createCommentVNode("",!0),canvasMenuEnabled.value?(openBlock(),createBlock(GraphCanvasMenu,{key:1})):createCommentVNode("",!0)]),_:2},[unref(isEmbedded)()?void 0:{name:"side-bar-panel",fn:withCtx(()=>[createVNode(SideToolbar)]),key:"0"}]),1024)):createCommentVNode("",!0),createVNode(TitleEditor),!betaMenuEnabled.value&&canvasMenuEnabled.value?(openBlock(),createBlock(GraphCanvasMenu,{key:1})):createCommentVNode("",!0),createBaseVNode("canvas",{ref_key:"canvasRef",ref:canvasRef,id:"graph-canvas",tabindex:"1"},null,512)])),createVNode(_sfc_main$h),tooltipEnabled.value?(openBlock(),createBlock(NodeTooltip,{key:0})):createCommentVNode("",!0),createVNode(_sfc_main$n)],64))}}),_sfc_main$7=defineComponent({__name:"GlobalToast",setup(__props){const toast=useToast(),toastStore=useToastStore(),settingStore=useSettingStore();watch(()=>toastStore.messagesToAdd,newMessages=>{newMessages.length!==0&&(newMessages.forEach(message=>{toast.add(message)}),toastStore.messagesToAdd=[])},{deep:!0}),watch(()=>toastStore.messagesToRemove,messagesToRemove=>{messagesToRemove.length!==0&&(messagesToRemove.forEach(message=>{toast.remove(message)}),toastStore.messagesToRemove=[])},{deep:!0}),watch(()=>toastStore.removeAllRequested,requested=>{requested&&(toast.removeAllGroups(),toastStore.removeAllRequested=!1)});function updateToastPosition(){const styleElement=document.getElementById("dynamic-toast-style")||createStyleElement(),rect=document.querySelector(".graph-canvas-container").getBoundingClientRect();styleElement.textContent=`
    .p-toast.p-component.p-toast-top-right {
      top: ${rect.top+20}px !important;
      right: ${window.innerWidth-(rect.left+rect.width)+20}px !important;
    }
  `}__name(updateToastPosition,"updateToastPosition");function createStyleElement(){const style=document.createElement("style");return style.id="dynamic-toast-style",document.head.appendChild(style),style}return __name(createStyleElement,"createStyleElement"),watch(()=>settingStore.get("Comfy.UseNewMenu"),()=>nextTick(updateToastPosition),{immediate:!0}),watch(()=>settingStore.get("Comfy.Sidebar.Location"),()=>nextTick(updateToastPosition),{immediate:!0}),(_ctx,_cache)=>(openBlock(),createBlock(unref(script$f)))}}),_hoisted_1$9={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function render$5(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$9,_cache[0]||(_cache[0]=[createBaseVNode("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 4v16m4-16l10 8l-10 8z"},null,-1)]))}__name(render$5,"render$5");const __unplugin_components_3=markRaw({name:"lucide-step-forward",render:render$5}),_hoisted_1$8={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function render$4(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$8,_cache[0]||(_cache[0]=[createBaseVNode("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m13 19l9-7l-9-7zM2 19l9-7l-9-7z"},null,-1)]))}__name(render$4,"render$4");const __unplugin_components_2=markRaw({name:"lucide-fast-forward",render:render$4}),_hoisted_1$7={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function render$3(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$7,_cache[0]||(_cache[0]=[createBaseVNode("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m6 3l14 9l-14 9z"},null,-1)]))}__name(render$3,"render$3");const __unplugin_components_1$1=markRaw({name:"lucide-play",render:render$3}),_hoisted_1$6={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function render$2(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$6,_cache[0]||(_cache[0]=[createBaseVNode("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[createBaseVNode("path",{d:"M16 12H3m13 6H3m7-12H3m18 12V8a2 2 0 0 0-2-2h-5"}),createBaseVNode("path",{d:"m16 8l-2-2l2-2"})],-1)]))}__name(render$2,"render$2");const __unplugin_components_0$1=markRaw({name:"lucide-list-start",render:render$2}),_hoisted_1$5=["aria-label"],minQueueCount=1,_sfc_main$6=defineComponent({__name:"BatchCountEdit",props:{class:{default:""}},setup(__props){const props=__props,queueSettingsStore=useQueueSettingsStore(),{batchCount}=storeToRefs(queueSettingsStore),settingStore=useSettingStore(),maxQueueCount=computed(()=>settingStore.get("Comfy.QueueButton.BatchCountLimit")),handleClick=__name(increment=>{let newCount;if(increment){const originalCount=batchCount.value-1;newCount=Math.min(originalCount*2,maxQueueCount.value)}else{const originalCount=batchCount.value+1;newCount=Math.floor(originalCount/2)}batchCount.value=newCount},"handleClick");return(_ctx,_cache)=>{const _directive_tooltip=resolveDirective("tooltip");return withDirectives((openBlock(),createElementBlock("div",{class:normalizeClass(["batch-count",props.class]),"aria-label":_ctx.$t("menu.batchCount")},[createVNode(unref(script$g),{class:"w-14",modelValue:unref(batchCount),"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>isRef(batchCount)?batchCount.value=$event:null),min:minQueueCount,max:maxQueueCount.value,fluid:"",showButtons:"",pt:{incrementButton:{class:"w-6",onmousedown:__name(()=>{handleClick(!0)},"onmousedown")},decrementButton:{class:"w-6",onmousedown:__name(()=>{handleClick(!1)},"onmousedown")}}},null,8,["modelValue","max","pt"])],10,_hoisted_1$5)),[[_directive_tooltip,_ctx.$t("menu.batchCount"),void 0,{bottom:!0}]])}}}),BatchCountEdit=_export_sfc(_sfc_main$6,[["__scopeId","data-v-26957f1f"]]),_hoisted_1$4={class:"queue-button-group flex"},_sfc_main$5=defineComponent({__name:"ComfyQueueButton",setup(__props){const workspaceStore=useWorkspaceStore(),queueCountStore=storeToRefs(useQueuePendingTaskCountStore()),{mode:queueMode}=storeToRefs(useQueueSettingsStore()),{t:t2}=useI18n(),queueModeMenuItemLookup=computed(()=>({disabled:{key:"disabled",label:t2("menu.queue"),tooltip:t2("menu.disabledTooltip"),command:__name(()=>{queueMode.value="disabled"},"command")},instant:{key:"instant",label:`${t2("menu.queue")} (${t2("menu.instant")})`,tooltip:t2("menu.instantTooltip"),command:__name(()=>{queueMode.value="instant"},"command")},change:{key:"change",label:`${t2("menu.queue")} (${t2("menu.onChange")})`,tooltip:t2("menu.onChangeTooltip"),command:__name(()=>{queueMode.value="change"},"command")}})),activeQueueModeMenuItem=computed(()=>queueModeMenuItemLookup.value[queueMode.value]),queueModeMenuItems=computed(()=>Object.values(queueModeMenuItemLookup.value)),executingPrompt=computed(()=>!!queueCountStore.count.value),hasPendingTasks=computed(()=>queueCountStore.count.value>1),commandStore=useCommandStore(),queuePrompt=__name(e=>{const commandId=e.shiftKey?"Comfy.QueuePromptFront":"Comfy.QueuePrompt";commandStore.execute(commandId)},"queuePrompt");return(_ctx,_cache)=>{const _component_i_lucide58list_start=__unplugin_components_0$1,_component_i_lucide58play=__unplugin_components_1$1,_component_i_lucide58fast_forward=__unplugin_components_2,_component_i_lucide58step_forward=__unplugin_components_3,_directive_tooltip=resolveDirective("tooltip");return openBlock(),createElementBlock("div",_hoisted_1$4,[withDirectives((openBlock(),createBlock(unref(script$h),{class:"comfyui-queue-button",label:activeQueueModeMenuItem.value.label,severity:"primary",size:"small",onClick:queuePrompt,model:queueModeMenuItems.value,"data-testid":"queue-button"},{icon:withCtx(()=>[unref(workspaceStore).shiftDown?(openBlock(),createBlock(_component_i_lucide58list_start,{key:0})):unref(queueMode)==="disabled"?(openBlock(),createBlock(_component_i_lucide58play,{key:1})):unref(queueMode)==="instant"?(openBlock(),createBlock(_component_i_lucide58fast_forward,{key:2})):unref(queueMode)==="change"?(openBlock(),createBlock(_component_i_lucide58step_forward,{key:3})):createCommentVNode("",!0)]),item:withCtx(({item})=>[withDirectives(createVNode(unref(script),{label:String(item.label),icon:item.icon,severity:item.key===unref(queueMode)?"primary":"secondary",size:"small",text:""},null,8,["label","icon","severity"]),[[_directive_tooltip,item.tooltip]])]),_:1},8,["label","model"])),[[_directive_tooltip,unref(workspaceStore).shiftDown?_ctx.$t("menu.queueWorkflowFront"):_ctx.$t("menu.queueWorkflow"),void 0,{bottom:!0}]]),createVNode(BatchCountEdit),createVNode(unref(script$6),{class:"execution-actions flex flex-nowrap"},{default:withCtx(()=>[withDirectives(createVNode(unref(script),{icon:"pi pi-times",severity:executingPrompt.value?"danger":"secondary",disabled:!executingPrompt.value,text:"","aria-label":_ctx.$t("menu.interrupt"),onClick:_cache[0]||(_cache[0]=()=>unref(commandStore).execute("Comfy.Interrupt"))},null,8,["severity","disabled","aria-label"]),[[_directive_tooltip,_ctx.$t("menu.interrupt"),void 0,{bottom:!0}]]),withDirectives(createVNode(unref(script),{icon:"pi pi-stop",severity:hasPendingTasks.value?"danger":"secondary",disabled:!hasPendingTasks.value,text:"","aria-label":_ctx.$t("sideToolbar.queueTab.clearPendingTasks"),onClick:_cache[1]||(_cache[1]=()=>unref(commandStore).execute("Comfy.ClearPendingTasks"))},null,8,["severity","disabled","aria-label"]),[[_directive_tooltip,_ctx.$t("sideToolbar.queueTab.clearPendingTasks"),void 0,{bottom:!0}]])]),_:1})])}}}),ComfyQueueButton=_export_sfc(_sfc_main$5,[["__scopeId","data-v-91a628af"]]),overlapThreshold=20,_sfc_main$4=defineComponent({__name:"ComfyActionbar",setup(__props){const settingsStore=useSettingStore(),visible=computed(()=>settingsStore.get("Comfy.UseNewMenu")!=="Disabled"),panelRef=ref(null),dragHandleRef=ref(null),isDocked=useLocalStorage("Comfy.MenuPosition.Docked",!1),storedPosition=useLocalStorage("Comfy.MenuPosition.Floating",{x:0,y:0}),{x,y,style,isDragging}=useDraggable(panelRef,{initialValue:{x:0,y:0},handle:dragHandleRef,containerElement:document.body});watchDebounced([x,y],([newX,newY])=>{storedPosition.value={x:newX,y:newY}},{debounce:300});const setInitialPosition=__name(()=>{if(!(x.value!==0||y.value!==0)){if(storedPosition.value.x!==0||storedPosition.value.y!==0){x.value=storedPosition.value.x,y.value=storedPosition.value.y,captureLastDragState();return}if(panelRef.value){const screenWidth=window.innerWidth,screenHeight=window.innerHeight,menuWidth=panelRef.value.offsetWidth,menuHeight=panelRef.value.offsetHeight;if(menuWidth===0||menuHeight===0)return;x.value=(screenWidth-menuWidth)/2,y.value=screenHeight-menuHeight-10,captureLastDragState()}}},"setInitialPosition");onMounted(setInitialPosition),watch(visible,newVisible=>{newVisible&&nextTick(setInitialPosition)});const lastDragState=ref({x:x.value,y:y.value,windowWidth:window.innerWidth,windowHeight:window.innerHeight}),captureLastDragState=__name(()=>{lastDragState.value={x:x.value,y:y.value,windowWidth:window.innerWidth,windowHeight:window.innerHeight}},"captureLastDragState");watch(isDragging,newIsDragging=>{newIsDragging||captureLastDragState()},{immediate:!0}),useEventListener(window,"resize",__name(()=>{if(panelRef.value){const screenWidth=window.innerWidth,screenHeight=window.innerHeight,menuWidth=panelRef.value.offsetWidth,menuHeight=panelRef.value.offsetHeight,distanceLeft=lastDragState.value.x,distanceRight=lastDragState.value.windowWidth-(lastDragState.value.x+menuWidth),distanceTop=lastDragState.value.y,distanceBottom=lastDragState.value.windowHeight-(lastDragState.value.y+menuHeight),closestEdge=[{edge:"left",distance:distanceLeft},{edge:"right",distance:distanceRight},{edge:"top",distance:distanceTop},{edge:"bottom",distance:distanceBottom}].reduce((min,curr)=>curr.distance<min.distance?curr:min),verticalRatio=lastDragState.value.y/lastDragState.value.windowHeight,horizontalRatio=lastDragState.value.x/lastDragState.value.windowWidth;closestEdge.edge==="left"?(x.value=closestEdge.distance,y.value=verticalRatio*screenHeight):closestEdge.edge==="right"?(x.value=screenWidth-menuWidth-closestEdge.distance,y.value=verticalRatio*screenHeight):closestEdge.edge==="top"?(x.value=horizontalRatio*screenWidth,y.value=closestEdge.distance):(x.value=horizontalRatio*screenWidth,y.value=screenHeight-menuHeight-closestEdge.distance),x.value=lodashExports.clamp(x.value,0,screenWidth-menuWidth),y.value=lodashExports.clamp(y.value,0,screenHeight-menuHeight)}},"adjustMenuPosition"));const topMenuRef=inject("topMenuRef"),topMenuBounds=useElementBounding(topMenuRef),isOverlappingWithTopMenu=computed(()=>{if(!panelRef.value)return!1;const{height}=panelRef.value.getBoundingClientRect(),actionbarBottom=y.value+height,topMenuBottom=topMenuBounds.bottom.value;return Math.min(actionbarBottom,topMenuBottom)-Math.max(y.value,topMenuBounds.top.value)>overlapThreshold});watch(isDragging,newIsDragging=>{newIsDragging?isDocked.value=!1:isDocked.value=isOverlappingWithTopMenu.value});const eventBus=useEventBus("topMenu");return watch([isDragging,isOverlappingWithTopMenu],([dragging,overlapping])=>{eventBus.emit("updateHighlight",{isDragging:dragging,isOverlapping:overlapping})}),(_ctx,_cache)=>(openBlock(),createBlock(unref(script$i),{class:normalizeClass(["actionbar w-fit",{"is-dragging":unref(isDragging),"is-docked":unref(isDocked)}]),style:normalizeStyle(unref(style))},{default:withCtx(()=>[createBaseVNode("div",{class:"actionbar-content flex items-center",ref_key:"panelRef",ref:panelRef},[createBaseVNode("span",{class:"drag-handle cursor-move mr-2 p-0!",ref_key:"dragHandleRef",ref:dragHandleRef},null,512),createVNode(ComfyQueueButton)],512)]),_:1},8,["style","class"]))}}),Actionbar=_export_sfc(_sfc_main$4,[["__scopeId","data-v-915e5456"]]),_hoisted_1$3={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function render$1(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$3,_cache[0]||(_cache[0]=[createBaseVNode("path",{fill:"currentColor",d:"M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21zm0-5v3h14v-3zm0-2h14V5H5zm0 2v3z"},null,-1)]))}__name(render$1,"render$1");const __unplugin_components_1=markRaw({name:"material-symbols-dock-to-bottom-outline",render:render$1}),_hoisted_1$2={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function render(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$2,_cache[0]||(_cache[0]=[createBaseVNode("path",{fill:"currentColor",d:"M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21zm0-7h14V5H5z"},null,-1)]))}__name(render,"render");const __unplugin_components_0=markRaw({name:"material-symbols-dock-to-bottom",render}),_sfc_main$3=defineComponent({__name:"BottomPanelToggleButton",setup(__props){const bottomPanelStore=useBottomPanelStore();return(_ctx,_cache)=>{const _component_i_material_symbols58dock_to_bottom=__unplugin_components_0,_component_i_material_symbols58dock_to_bottom_outline=__unplugin_components_1,_directive_tooltip=resolveDirective("tooltip");return withDirectives((openBlock(),createBlock(unref(script),{severity:"secondary",text:"","aria-label":_ctx.$t("menu.toggleBottomPanel"),onClick:unref(bottomPanelStore).toggleBottomPanel},{icon:withCtx(()=>[unref(bottomPanelStore).bottomPanelVisible?(openBlock(),createBlock(_component_i_material_symbols58dock_to_bottom,{key:0})):(openBlock(),createBlock(_component_i_material_symbols58dock_to_bottom_outline,{key:1}))]),_:1},8,["aria-label","onClick"])),[[vShow,unref(bottomPanelStore).bottomPanelTabs.length>0],[_directive_tooltip,{value:_ctx.$t("menu.toggleBottomPanel"),showDelay:300}]])}}}),_hoisted_1$1=["href"],_hoisted_2$1={class:"p-menubar-item-label"},_hoisted_3$1={key:1,class:"ml-auto border border-surface rounded text-muted text-xs text-nowrap p-1 keybinding-tag"},_sfc_main$2=defineComponent({__name:"CommandMenubar",setup(__props){const settingStore=useSettingStore(),dropdownDirection=computed(()=>settingStore.get("Comfy.UseNewMenu")==="Top"?"down":"up"),menuItemsStore=useMenuItemStore(),{t:t2}=useI18n(),translateMenuItem=__name(item=>{const label=typeof item.label=="function"?item.label():item.label,translatedLabel=label?t2(`menuLabels.${normalizeI18nKey(label)}`,label):void 0;return{...item,label:translatedLabel,items:item.items?.map(translateMenuItem)}},"translateMenuItem"),translatedItems=computed(()=>menuItemsStore.menuItems.map(translateMenuItem));return(_ctx,_cache)=>(openBlock(),createBlock(unref(script$j),{model:translatedItems.value,class:"top-menubar border-none p-0 bg-transparent",pt:{rootList:"gap-0 flex-nowrap w-auto",submenu:`dropdown-direction-${dropdownDirection.value}`,item:"relative"}},{item:withCtx(({item,props})=>[createBaseVNode("a",mergeProps({class:"p-menubar-item-link"},props.action,{href:item.url,target:"_blank"}),[item.icon?(openBlock(),createElementBlock("span",{key:0,class:normalizeClass(["p-menubar-item-icon",item.icon])},null,2)):createCommentVNode("",!0),createBaseVNode("span",_hoisted_2$1,toDisplayString(item.label),1),item?.comfyCommand?.keybinding?(openBlock(),createElementBlock("span",_hoisted_3$1,toDisplayString(item.comfyCommand.keybinding.combo.toString()),1)):createCommentVNode("",!0)],16,_hoisted_1$1)]),_:1},8,["model","pt"]))}}),CommandMenubar=_export_sfc(_sfc_main$2,[["__scopeId","data-v-56df69d2"]]),_hoisted_1={class:"flex-grow min-w-0 app-drag h-full"},_hoisted_2={class:"window-actions-spacer flex-shrink-0"},_hoisted_3={class:"fixed top-0 left-0 app-drag w-full h-[var(--comfy-topbar-height)]"},_sfc_main$1=defineComponent({__name:"TopMenubar",setup(__props){const workspaceState=useWorkspaceStore(),settingStore=useSettingStore(),workflowTabsPosition=computed(()=>settingStore.get("Comfy.Workflow.WorkflowTabsPosition")),menuSetting=computed(()=>settingStore.get("Comfy.UseNewMenu")),betaMenuEnabled=computed(()=>menuSetting.value!=="Disabled"),teleportTarget=computed(()=>settingStore.get("Comfy.UseNewMenu")==="Top"?".comfyui-body-top":".comfyui-body-bottom"),showTopMenu=computed(()=>betaMenuEnabled.value&&!workspaceState.focusMode),menuRight=ref(null);onMounted(()=>{menuRight.value&&menuRight.value.appendChild(app.menu.element)});const topMenuRef=ref(null);provide("topMenuRef",topMenuRef);const eventBus=useEventBus("topMenu"),isDropZone=ref(!1),isDroppable=ref(!1);return eventBus.on((event,payload)=>{event==="updateHighlight"&&(isDropZone.value=payload.isDragging,isDroppable.value=payload.isOverlapping&&payload.isDragging)}),onMounted(()=>{isElectron()&&electronAPI().changeTheme({height:topMenuRef.value.getBoundingClientRect().height})}),(_ctx,_cache)=>{const _directive_tooltip=resolveDirective("tooltip");return openBlock(),createElementBlock(Fragment,null,[(openBlock(),createBlock(Teleport,{to:teleportTarget.value},[withDirectives(createBaseVNode("div",{ref_key:"topMenuRef",ref:topMenuRef,class:normalizeClass(["comfyui-menu flex items-center",{dropzone:isDropZone.value,"dropzone-active":isDroppable.value}])},[_cache[1]||(_cache[1]=createBaseVNode("h1",{class:"comfyui-logo mx-2 app-drag"},"ComfyUI",-1)),createVNode(CommandMenubar),createBaseVNode("div",_hoisted_1,[workflowTabsPosition.value==="Topbar"&&!unref(isEmbedded)()?(openBlock(),createBlock(WorkflowTabs,{key:0})):createCommentVNode("",!0)]),createBaseVNode("div",{class:"comfyui-menu-right flex-shrink-0",ref_key:"menuRight",ref:menuRight},null,512),createVNode(Actionbar),createVNode(_sfc_main$3,{class:"flex-shrink-0"}),withDirectives(createVNode(unref(script),{class:"flex-shrink-0",icon:"pi pi-bars",severity:"secondary",text:"","aria-label":_ctx.$t("menu.hideMenu"),onClick:_cache[0]||(_cache[0]=$event=>unref(workspaceState).focusMode=!0),onContextmenu:unref(showNativeMenu)},null,8,["aria-label","onContextmenu"]),[[_directive_tooltip,{value:_ctx.$t("menu.hideMenu"),showDelay:300}]]),withDirectives(createBaseVNode("div",_hoisted_2,null,512),[[vShow,menuSetting.value!=="Bottom"]])],2),[[vShow,showTopMenu.value]])],8,["to"])),withDirectives(createBaseVNode("div",_hoisted_3,null,512),[[vShow,unref(isNativeWindow)()&&!showTopMenu.value]])],64)}}}),TopMenubar=_export_sfc(_sfc_main$1,[["__scopeId","data-v-b69e98a4"]]);function useCoreCommands(){const workflowService=useWorkflowService(),workflowStore=useWorkflowStore(),dialogService=useDialogService(),colorPaletteStore=useColorPaletteStore(),getTracker=__name(()=>workflowStore.activeWorkflow?.changeTracker,"getTracker"),getSelectedNodes=__name(()=>{const selectedNodes=app.canvas.selected_nodes,result=[];if(selectedNodes)for(const i in selectedNodes){const node=selectedNodes[i];result.push(node)}return result},"getSelectedNodes"),toggleSelectedNodesMode=__name(mode=>{getSelectedNodes().forEach(node=>{node.mode===mode?node.mode=LGraphEventMode.ALWAYS:node.mode=mode})},"toggleSelectedNodesMode");return[{id:"Comfy.NewBlankWorkflow",icon:"pi pi-plus",label:"New Blank Workflow",menubarLabel:"New",function:__name(()=>workflowService.loadBlankWorkflow(),"function")},{id:"Comfy.OpenWorkflow",icon:"pi pi-folder-open",label:"Open Workflow",menubarLabel:"Open",function:__name(()=>{app.ui.loadFile()},"function")},{id:"Comfy.LoadDefaultWorkflow",icon:"pi pi-code",label:"Load Default Workflow",function:__name(()=>workflowService.loadDefaultWorkflow(),"function")},{id:"Comfy.SaveWorkflow",icon:"pi pi-save",label:"Save Workflow",menubarLabel:"Save",function:__name(async()=>{const workflow=useWorkflowStore().activeWorkflow;workflow&&await workflowService.saveWorkflow(workflow)},"function")},{id:"Comfy.SaveWorkflowAs",icon:"pi pi-save",label:"Save Workflow As",menubarLabel:"Save As",function:__name(async()=>{const workflow=useWorkflowStore().activeWorkflow;workflow&&await workflowService.saveWorkflowAs(workflow)},"function")},{id:"Comfy.ExportWorkflow",icon:"pi pi-download",label:"Export Workflow",menubarLabel:"Export",function:__name(()=>{workflowService.exportWorkflow("workflow","workflow")},"function")},{id:"Comfy.ExportWorkflowAPI",icon:"pi pi-download",label:"Export Workflow (API Format)",menubarLabel:"Export (API)",function:__name(()=>{workflowService.exportWorkflow("workflow_api","output")},"function")},{id:"Comfy.Undo",icon:"pi pi-undo",label:"Undo",function:__name(async()=>{await getTracker()?.undo?.()},"function")},{id:"Comfy.Redo",icon:"pi pi-refresh",label:"Redo",function:__name(async()=>{await getTracker()?.redo?.()},"function")},{id:"Comfy.ClearWorkflow",icon:"pi pi-trash",label:"Clear Workflow",function:__name(()=>{(!useSettingStore().get("Comfy.ComfirmClear")||confirm("Clear workflow?"))&&(app.clean(),app.graph.clear(),api.dispatchCustomEvent("graphCleared"))},"function")},{id:"Comfy.Canvas.ResetView",icon:"pi pi-expand",label:"Reset View",function:__name(()=>{useLitegraphService().resetView()},"function")},{id:"Comfy.OpenClipspace",icon:"pi pi-clipboard",label:"Clipspace",function:__name(()=>{app.openClipspace()},"function")},{id:"Comfy.RefreshNodeDefinitions",icon:"pi pi-refresh",label:"Refresh Node Definitions",function:__name(async()=>{await app.refreshComboInNodes()},"function")},{id:"Comfy.Interrupt",icon:"pi pi-stop",label:"Interrupt",function:__name(async()=>{await api.interrupt(),useToastStore().add({severity:"info",summary:"Interrupted",detail:"Execution has been interrupted",life:1e3})},"function")},{id:"Comfy.ClearPendingTasks",icon:"pi pi-stop",label:"Clear Pending Tasks",function:__name(async()=>{await useQueueStore().clear(["queue"]),useToastStore().add({severity:"info",summary:"Confirmed",detail:"Pending tasks deleted",life:3e3})},"function")},{id:"Comfy.BrowseTemplates",icon:"pi pi-folder-open",label:"Browse Templates",function:__name(()=>{dialogService.showTemplateWorkflowsDialog()},"function")},{id:"Comfy.Canvas.ZoomIn",icon:"pi pi-plus",label:"Zoom In",function:__name(()=>{const ds=app.canvas.ds;ds.changeScale(ds.scale*1.1,ds.element?[ds.element.width/2,ds.element.height/2]:void 0),app.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ZoomOut",icon:"pi pi-minus",label:"Zoom Out",function:__name(()=>{const ds=app.canvas.ds;ds.changeScale(ds.scale/1.1,ds.element?[ds.element.width/2,ds.element.height/2]:void 0),app.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.FitView",icon:"pi pi-expand",label:"Fit view to selected nodes",function:__name(()=>{if(app.canvas.empty){useToastStore().add({severity:"error",summary:"Empty canvas",life:3e3});return}app.canvas.fitViewToSelectionAnimated()},"function")},{id:"Comfy.Canvas.ToggleLock",icon:"pi pi-lock",label:"Canvas Toggle Lock",function:__name(()=>{app.canvas.read_only=!app.canvas.read_only},"function")},{id:"Comfy.Canvas.ToggleLinkVisibility",icon:"pi pi-eye",label:"Canvas Toggle Link Visibility",versionAdded:"1.3.6",function:(()=>{const settingStore=useSettingStore();let lastLinksRenderMode=LiteGraph.SPLINE_LINK;return()=>{const currentMode=settingStore.get("Comfy.LinkRenderMode");currentMode===LiteGraph.HIDDEN_LINK?settingStore.set("Comfy.LinkRenderMode",lastLinksRenderMode):(lastLinksRenderMode=currentMode,settingStore.set("Comfy.LinkRenderMode",LiteGraph.HIDDEN_LINK))}})()},{id:"Comfy.QueuePrompt",icon:"pi pi-play",label:"Queue Prompt",versionAdded:"1.3.7",function:__name(()=>{const batchCount=useQueueSettingsStore().batchCount;app.queuePrompt(0,batchCount)},"function")},{id:"Comfy.QueuePromptFront",icon:"pi pi-play",label:"Queue Prompt (Front)",versionAdded:"1.3.7",function:__name(()=>{const batchCount=useQueueSettingsStore().batchCount;app.queuePrompt(-1,batchCount)},"function")},{id:"Comfy.ShowSettingsDialog",icon:"pi pi-cog",label:"Show Settings Dialog",versionAdded:"1.3.7",function:__name(()=>{dialogService.showSettingsDialog()},"function")},{id:"Comfy.Graph.GroupSelectedNodes",icon:"pi pi-sitemap",label:"Group Selected Nodes",versionAdded:"1.3.7",function:__name(()=>{const{canvas}=app;if(!canvas.selectedItems?.size){useToastStore().add({severity:"error",summary:"Nothing to group",detail:"Please select the nodes (or other groups) to create a group for",life:3e3});return}const group=new LGraphGroup,padding=useSettingStore().get("Comfy.GroupSelectedNodes.Padding");group.resizeTo(canvas.selectedItems,padding),canvas.graph.add(group),useTitleEditorStore().titleEditorTarget=group},"function")},{id:"Workspace.NextOpenedWorkflow",icon:"pi pi-step-forward",label:"Next Opened Workflow",versionAdded:"1.3.9",function:__name(()=>{workflowService.loadNextOpenedWorkflow()},"function")},{id:"Workspace.PreviousOpenedWorkflow",icon:"pi pi-step-backward",label:"Previous Opened Workflow",versionAdded:"1.3.9",function:__name(()=>{workflowService.loadPreviousOpenedWorkflow()},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Mute",icon:"pi pi-volume-off",label:"Mute/Unmute Selected Nodes",versionAdded:"1.3.11",function:__name(()=>{toggleSelectedNodesMode(LGraphEventMode.NEVER)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Bypass",icon:"pi pi-shield",label:"Bypass/Unbypass Selected Nodes",versionAdded:"1.3.11",function:__name(()=>{toggleSelectedNodesMode(LGraphEventMode.BYPASS)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Pin",icon:"pi pi-pin",label:"Pin/Unpin Selected Nodes",versionAdded:"1.3.11",function:__name(()=>{getSelectedNodes().forEach(node=>{node.pin(!node.pinned)})},"function")},{id:"Comfy.Canvas.ToggleSelected.Pin",icon:"pi pi-pin",label:"Pin/Unpin Selected Items",versionAdded:"1.3.33",function:__name(()=>{for(const item of app.canvas.selectedItems)(item instanceof LGraphNode||item instanceof LGraphGroup)&&item.pin(!item.pinned)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Collapse",icon:"pi pi-minus",label:"Collapse/Expand Selected Nodes",versionAdded:"1.3.11",function:__name(()=>{getSelectedNodes().forEach(node=>{node.collapse()})},"function")},{id:"Comfy.ToggleTheme",icon:"pi pi-moon",label:"Toggle Theme (Dark/Light)",versionAdded:"1.3.12",function:(()=>{let previousDarkTheme=DEFAULT_DARK_COLOR_PALETTE.id,previousLightTheme=DEFAULT_LIGHT_COLOR_PALETTE.id;return()=>{const settingStore=useSettingStore(),theme=colorPaletteStore.completedActivePalette;theme.light_theme?(previousLightTheme=theme.id,settingStore.set("Comfy.ColorPalette",previousDarkTheme)):(previousDarkTheme=theme.id,settingStore.set("Comfy.ColorPalette",previousLightTheme))}})()},{id:"Workspace.ToggleBottomPanel",icon:"pi pi-list",label:"Toggle Bottom Panel",versionAdded:"1.3.22",function:__name(()=>{useBottomPanelStore().toggleBottomPanel()},"function")},{id:"Workspace.ToggleFocusMode",icon:"pi pi-eye",label:"Toggle Focus Mode",versionAdded:"1.3.27",function:__name(()=>{useWorkspaceStore().toggleFocusMode()},"function")},{id:"Comfy.Graph.FitGroupToContents",icon:"pi pi-expand",label:"Fit Group To Contents",versionAdded:"1.4.9",function:__name(()=>{for(const group of app.canvas.selectedItems)if(group instanceof LGraphGroup){group.recomputeInsideNodes();const padding=useSettingStore().get("Comfy.GroupSelectedNodes.Padding");group.resizeTo(group.children,padding),app.graph.change()}},"function")},{id:"Comfy.Help.OpenComfyUIIssues",icon:"pi pi-github",label:"Open ComfyUI Issues",menubarLabel:"ComfyUI Issues",versionAdded:"1.5.5",function:__name(()=>{window.open("https://github.com/comfyanonymous/ComfyUI/issues","_blank")},"function")},{id:"Comfy.Help.OpenComfyUIDocs",icon:"pi pi-info-circle",label:"Open ComfyUI Docs",menubarLabel:"ComfyUI Docs",versionAdded:"1.5.5",function:__name(()=>{window.open("https://docs.comfy.org/","_blank")},"function")},{id:"Comfy.Help.OpenComfyOrgDiscord",icon:"pi pi-discord",label:"Open Comfy-Org Discord",menubarLabel:"Comfy-Org Discord",versionAdded:"1.5.5",function:__name(()=>{window.open("https://www.comfy.org/discord","_blank")},"function")},{id:"Workspace.SearchBox.Toggle",icon:"pi pi-search",label:"Toggle Search Box",versionAdded:"1.5.7",function:__name(()=>{useSearchBoxStore().toggleVisible()},"function")},{id:"Comfy.Help.AboutComfyUI",icon:"pi pi-info-circle",label:"Open About ComfyUI",menubarLabel:"About ComfyUI",versionAdded:"1.6.4",function:__name(()=>{dialogService.showSettingsDialog("about")},"function")},{id:"Comfy.DuplicateWorkflow",icon:"pi pi-clone",label:"Duplicate Current Workflow",versionAdded:"1.6.15",function:__name(()=>{workflowService.duplicateWorkflow(workflowStore.activeWorkflow)},"function")},{id:"Workspace.CloseWorkflow",icon:"pi pi-times",label:"Close Current Workflow",versionAdded:"1.7.3",function:__name(()=>{workflowStore.activeWorkflow&&workflowService.closeWorkflow(workflowStore.activeWorkflow)},"function")},{id:"Comfy.Feedback",icon:"pi pi-megaphone",label:"Give Feedback",versionAdded:"1.8.2",function:__name(()=>{dialogService.showIssueReportDialog({title:t("g.feedback"),subtitle:t("issueReport.feedbackTitle"),panelProps:{errorType:"Feedback",defaultFields:["SystemStats","Settings"]}})},"function")},{id:"Comfy.Help.OpenComfyUIForum",icon:"pi pi-comments",label:"Open ComfyUI Forum",menubarLabel:"ComfyUI Forum",versionAdded:"1.8.2",function:__name(()=>{window.open("https://forum.comfy.org/","_blank")},"function")}]}__name(useCoreCommands,"useCoreCommands");var LatentPreviewMethod=(LatentPreviewMethod2=>(LatentPreviewMethod2.NoPreviews="none",LatentPreviewMethod2.Auto="auto",LatentPreviewMethod2.Latent2RGB="latent2rgb",LatentPreviewMethod2.TAESD="taesd",LatentPreviewMethod2))(LatentPreviewMethod||{}),LogLevel=(LogLevel2=>(LogLevel2.DEBUG="DEBUG",LogLevel2.INFO="INFO",LogLevel2.WARNING="WARNING",LogLevel2.ERROR="ERROR",LogLevel2.CRITICAL="CRITICAL",LogLevel2))(LogLevel||{}),HashFunction=(HashFunction2=>(HashFunction2.MD5="md5",HashFunction2.SHA1="sha1",HashFunction2.SHA256="sha256",HashFunction2.SHA512="sha512",HashFunction2))(HashFunction||{}),AutoLaunch=(AutoLaunch2=>(AutoLaunch2.Auto="auto",AutoLaunch2.Disable="disable",AutoLaunch2.Enable="enable",AutoLaunch2))(AutoLaunch||{}),CudaMalloc=(CudaMalloc2=>(CudaMalloc2.Auto="auto",CudaMalloc2.Disable="disable",CudaMalloc2.Enable="enable",CudaMalloc2))(CudaMalloc||{}),FloatingPointPrecision=(FloatingPointPrecision2=>(FloatingPointPrecision2.AUTO="auto",FloatingPointPrecision2.FP64="fp64",FloatingPointPrecision2.FP32="fp32",FloatingPointPrecision2.FP16="fp16",FloatingPointPrecision2.BF16="bf16",FloatingPointPrecision2.FP8E4M3FN="fp8_e4m3fn",FloatingPointPrecision2.FP8E5M2="fp8_e5m2",FloatingPointPrecision2))(FloatingPointPrecision||{}),CrossAttentionMethod=(CrossAttentionMethod2=>(CrossAttentionMethod2.Auto="auto",CrossAttentionMethod2.Split="split",CrossAttentionMethod2.Quad="quad",CrossAttentionMethod2.Pytorch="pytorch",CrossAttentionMethod2))(CrossAttentionMethod||{}),VramManagement=(VramManagement2=>(VramManagement2.Auto="auto",VramManagement2.GPUOnly="gpu-only",VramManagement2.HighVram="highvram",VramManagement2.NormalVram="normalvram",VramManagement2.LowVram="lowvram",VramManagement2.NoVram="novram",VramManagement2.CPU="cpu",VramManagement2))(VramManagement||{});const WEB_ONLY_CONFIG_ITEMS=[{id:"auto-launch",name:"Automatically opens in the browser on startup",category:["Launch"],type:"combo",options:Object.values(AutoLaunch),defaultValue:AutoLaunch.Auto,getValue:__name(value=>{switch(value){case AutoLaunch.Auto:return{};case AutoLaunch.Enable:return{"auto-launch":!0};case AutoLaunch.Disable:return{"disable-auto-launch":!0}}},"getValue")}],SERVER_CONFIG_ITEMS=[{id:"listen",name:"Host: The IP address to listen on",category:["Network"],type:"text",defaultValue:"127.0.0.1"},{id:"port",name:"Port: The port to listen on",category:["Network"],type:"number",defaultValue:8e3},{id:"tls-keyfile",name:"TLS Key File: Path to TLS key file for HTTPS",category:["Network"],type:"text",defaultValue:""},{id:"tls-certfile",name:"TLS Certificate File: Path to TLS certificate file for HTTPS",category:["Network"],type:"text",defaultValue:""},{id:"enable-cors-header",name:'Enable CORS header: Use "*" for all origins or specify domain',category:["Network"],type:"text",defaultValue:""},{id:"max-upload-size",name:"Maximum upload size (MB)",category:["Network"],type:"number",defaultValue:100},{id:"cuda-device",name:"CUDA device index to use",category:["CUDA"],type:"number",defaultValue:null},{id:"cuda-malloc",name:"Use CUDA malloc for memory allocation",category:["CUDA"],type:"combo",options:Object.values(CudaMalloc),defaultValue:CudaMalloc.Auto,getValue:__name(value=>{switch(value){case CudaMalloc.Auto:return{};case CudaMalloc.Enable:return{"cuda-malloc":!0};case CudaMalloc.Disable:return{"disable-cuda-malloc":!0}}},"getValue")},{id:"global-precision",name:"Global floating point precision",category:["Inference"],type:"combo",options:[FloatingPointPrecision.AUTO,FloatingPointPrecision.FP32,FloatingPointPrecision.FP16],defaultValue:FloatingPointPrecision.AUTO,tooltip:"Global floating point precision",getValue:__name(value=>{switch(value){case FloatingPointPrecision.AUTO:return{};case FloatingPointPrecision.FP32:return{"force-fp32":!0};case FloatingPointPrecision.FP16:return{"force-fp16":!0};default:return{}}},"getValue")},{id:"unet-precision",name:"UNET precision",category:["Inference"],type:"combo",options:[FloatingPointPrecision.AUTO,FloatingPointPrecision.FP64,FloatingPointPrecision.FP32,FloatingPointPrecision.FP16,FloatingPointPrecision.BF16,FloatingPointPrecision.FP8E4M3FN,FloatingPointPrecision.FP8E5M2],defaultValue:FloatingPointPrecision.AUTO,tooltip:"UNET precision",getValue:__name(value=>{switch(value){case FloatingPointPrecision.AUTO:return{};default:return{[`${value.toLowerCase()}-unet`]:!0}}},"getValue")},{id:"vae-precision",name:"VAE precision",category:["Inference"],type:"combo",options:[FloatingPointPrecision.AUTO,FloatingPointPrecision.FP16,FloatingPointPrecision.FP32,FloatingPointPrecision.BF16],defaultValue:FloatingPointPrecision.AUTO,tooltip:"VAE precision",getValue:__name(value=>{switch(value){case FloatingPointPrecision.AUTO:return{};default:return{[`${value.toLowerCase()}-vae`]:!0}}},"getValue")},{id:"cpu-vae",name:"Run VAE on CPU",category:["Inference"],type:"boolean",defaultValue:!1},{id:"text-encoder-precision",name:"Text Encoder precision",category:["Inference"],type:"combo",options:[FloatingPointPrecision.AUTO,FloatingPointPrecision.FP8E4M3FN,FloatingPointPrecision.FP8E5M2,FloatingPointPrecision.FP16,FloatingPointPrecision.FP32],defaultValue:FloatingPointPrecision.AUTO,tooltip:"Text Encoder precision",getValue:__name(value=>{switch(value){case FloatingPointPrecision.AUTO:return{};default:return{[`${value.toLowerCase()}-text-enc`]:!0}}},"getValue")},{id:"force-channels-last",name:"Force channels-last memory format",category:["Memory"],type:"boolean",defaultValue:!1},{id:"directml",name:"DirectML device index",category:["Memory"],type:"number",defaultValue:null},{id:"disable-ipex-optimize",name:"Disable IPEX optimization",category:["Memory"],type:"boolean",defaultValue:!1},{id:"preview-method",name:"Method used for latent previews",category:["Preview"],type:"combo",options:Object.values(LatentPreviewMethod),defaultValue:LatentPreviewMethod.NoPreviews},{id:"preview-size",name:"Size of preview images",category:["Preview"],type:"slider",defaultValue:512,attrs:{min:128,max:2048,step:128}},{id:"cache-classic",name:"Use classic cache system",category:["Cache"],type:"boolean",defaultValue:!1},{id:"cache-lru",name:"Use LRU caching with a maximum of N node results cached.",category:["Cache"],type:"number",defaultValue:null,tooltip:"May use more RAM/VRAM."},{id:"cross-attention-method",name:"Cross attention method",category:["Attention"],type:"combo",options:Object.values(CrossAttentionMethod),defaultValue:CrossAttentionMethod.Auto,getValue:__name(value=>{switch(value){case CrossAttentionMethod.Auto:return{};default:return{[`use-${value.toLowerCase()}-cross-attention`]:!0}}},"getValue")},{id:"disable-xformers",name:"Disable xFormers optimization",type:"boolean",defaultValue:!1},{id:"force-upcast-attention",name:"Force attention upcast",category:["Attention"],type:"boolean",defaultValue:!1},{id:"dont-upcast-attention",name:"Prevent attention upcast",category:["Attention"],type:"boolean",defaultValue:!1},{id:"vram-management",name:"VRAM management mode",category:["Memory"],type:"combo",options:Object.values(VramManagement),defaultValue:VramManagement.Auto,getValue:__name(value=>{switch(value){case VramManagement.Auto:return{};default:return{[value]:!0}}},"getValue")},{id:"reserve-vram",name:"Reserved VRAM (GB)",category:["Memory"],type:"number",defaultValue:null,tooltip:"Set the amount of vram in GB you want to reserve for use by your OS/other software. By default some amount is reverved depending on your OS."},{id:"default-hashing-function",name:"Default hashing function for model files",type:"combo",options:Object.values(HashFunction),defaultValue:HashFunction.SHA256},{id:"disable-smart-memory",name:"Disable smart memory management",tooltip:"Force ComfyUI to aggressively offload to regular ram instead of keeping models in vram when it can.",category:["Memory"],type:"boolean",defaultValue:!1},{id:"deterministic",name:"Make pytorch use slower deterministic algorithms when it can.",type:"boolean",defaultValue:!1,tooltip:"Note that this might not make images deterministic in all cases."},{id:"fast",name:"Enable some untested and potentially quality deteriorating optimizations.",type:"boolean",defaultValue:!1},{id:"dont-print-server",name:"Don't print server output to console.",type:"boolean",defaultValue:!1},{id:"disable-metadata",name:"Disable saving prompt metadata in files.",type:"boolean",defaultValue:!1},{id:"disable-all-custom-nodes",name:"Disable loading all custom nodes.",type:"boolean",defaultValue:!1},{id:"log-level",name:"Logging verbosity level",type:"combo",options:Object.values(LogLevel),defaultValue:LogLevel.INFO,getValue:__name(value=>({verbose:value}),"getValue")},{id:"input-directory",name:"Input directory",category:["Directories"],type:"text",defaultValue:""},{id:"output-directory",name:"Output directory",category:["Directories"],type:"text",defaultValue:""}];function setupAutoQueueHandler(){const queueCountStore=useQueuePendingTaskCountStore(),queueSettingsStore=useQueueSettingsStore();let graphHasChanged=!1,internalCount=0;api.addEventListener("graphChanged",()=>{queueSettingsStore.mode==="change"&&(internalCount?graphHasChanged=!0:(graphHasChanged=!1,app.queuePrompt(0,queueSettingsStore.batchCount),internalCount++))}),queueCountStore.$subscribe(()=>{internalCount=queueCountStore.count,!internalCount&&!app.lastExecutionError&&(queueSettingsStore.mode==="instant"||queueSettingsStore.mode==="change"&&graphHasChanged)&&(graphHasChanged=!1,app.queuePrompt(0,queueSettingsStore.batchCount))},{detached:!0})}__name(setupAutoQueueHandler,"setupAutoQueueHandler");const _sfc_main=defineComponent({__name:"GraphView",setup(__props){setupAutoQueueHandler();const{t:t2}=useI18n(),toast=useToast(),settingStore=useSettingStore(),executionStore=useExecutionStore(),colorPaletteStore=useColorPaletteStore(),queueStore=useQueueStore();watch(()=>colorPaletteStore.completedActivePalette,newTheme=>{const DARK_THEME_CLASS="dark-theme";newTheme.light_theme?document.body.classList.remove(DARK_THEME_CLASS):document.body.classList.add(DARK_THEME_CLASS),isElectron()&&electronAPI().changeTheme({color:"rgba(0, 0, 0, 0)",symbolColor:newTheme.colors.comfy_base["input-text"]})},{immediate:!0}),isElectron()&&watch(()=>queueStore.tasks,(newTasks,oldTasks)=>{const oldRunningTaskIds=new Set(oldTasks.filter(task=>task.isRunning).map(task=>task.promptId));newTasks.filter(task=>oldRunningTaskIds.has(task.promptId)&&task.isHistory).forEach(task=>{electronAPI().Events.incrementUserProperty(`execution:${task.displayStatus.toLowerCase()}`,1),electronAPI().Events.trackEvent("execution",{status:task.displayStatus.toLowerCase()})})},{deep:!0}),watchEffect(()=>{const fontSize=settingStore.get("Comfy.TextareaWidget.FontSize");document.documentElement.style.setProperty("--comfy-textarea-font-size",`${fontSize}px`)}),watchEffect(()=>{const padding=settingStore.get("Comfy.TreeExplorer.ItemPadding");document.documentElement.style.setProperty("--comfy-tree-explorer-item-padding",`${padding}px`)}),watchEffect(()=>{const locale=settingStore.get("Comfy.Locale");locale&&(i18n.global.locale.value=locale)}),watchEffect(()=>{settingStore.get("Comfy.UseNewMenu")==="Disabled"?(app.ui.menuContainer.style.setProperty("display","block"),app.ui.restoreMenuPosition()):app.ui.menuContainer.style.setProperty("display","none")}),watchEffect(()=>{queueStore.maxHistoryItems=settingStore.get("Comfy.Queue.MaxHistoryItems")});const init=__name(()=>{const coreCommands=useCoreCommands();useCommandStore().registerCommands(coreCommands),useMenuItemStore().registerCoreMenuCommands(),useKeybindingService().registerCoreKeybindings(),useSidebarTabStore().registerCoreSidebarTabs(),useBottomPanelStore().registerCoreBottomPanelTabs(),app.extensionManager=useWorkspaceStore()},"init"),queuePendingTaskCountStore=useQueuePendingTaskCountStore(),onStatus=__name(async e=>{queuePendingTaskCountStore.update(e),await queueStore.update()},"onStatus"),reconnectingMessage={severity:"error",summary:t2("g.reconnecting")},onReconnecting=__name(()=>{toast.remove(reconnectingMessage),toast.add(reconnectingMessage)},"onReconnecting"),onReconnected=__name(()=>{toast.remove(reconnectingMessage),toast.add({severity:"success",summary:t2("g.reconnected"),life:2e3})},"onReconnected");onMounted(()=>{api.addEventListener("status",onStatus),api.addEventListener("reconnecting",onReconnecting),api.addEventListener("reconnected",onReconnected),executionStore.bindExecutionEvents();try{init()}catch(e){console.error("Failed to init ComfyUI frontend",e)}}),onBeforeUnmount(()=>{api.removeEventListener("status",onStatus),api.removeEventListener("reconnecting",onReconnecting),api.removeEventListener("reconnected",onReconnected),executionStore.unbindExecutionEvents()}),useEventListener(window,"keydown",useKeybindingService().keybindHandler);const{wrapWithErrorHandling,wrapWithErrorHandlingAsync}=useErrorHandling(),onGraphReady=__name(()=>{requestIdleCallback(()=>{wrapWithErrorHandling(useKeybindingService().registerUserKeybindings)(),wrapWithErrorHandling(useServerConfigStore().loadServerConfig)(SERVER_CONFIG_ITEMS,settingStore.get("Comfy.Server.ServerConfigValues")),wrapWithErrorHandlingAsync(useModelStore().loadModelFolders)(),wrapWithErrorHandlingAsync(useNodeFrequencyStore().loadNodeFrequencies)(),useNodeDefStore().nodeSearchService.endsWithFilterStartSequence("")},{timeout:1e3})},"onGraphReady");return(_ctx,_cache)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(TopMenubar),createVNode(_sfc_main$8,{onReady:onGraphReady}),createVNode(_sfc_main$7),unref(isElectron)()?createCommentVNode("",!0):(openBlock(),createBlock(_sfc_main$s,{key:0})),createVNode(_sfc_main$u),createVNode(MenuHamburger)],64))}});export{_sfc_main as default};
//# sourceMappingURL=GraphView-DG4bHK4_.js.map
