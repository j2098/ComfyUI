{"version":3,"file":"KeybindingPanel-DA0lDpGQ.js","sources":["../../src/components/dialog/content/setting/keybinding/KeyComboDisplay.vue","../../src/components/dialog/content/setting/KeybindingPanel.vue"],"sourcesContent":["<template>\n  <span>\n    <template v-for=\"(sequence, index) in keySequences\" :key=\"index\">\n      <Tag :severity=\"isModified ? 'info' : 'secondary'\">\n        {{ sequence }}\n      </Tag>\n      <span v-if=\"index < keySequences.length - 1\" class=\"px-2\">+</span>\n    </template>\n  </span>\n</template>\n\n<script setup lang=\"ts\">\nimport Tag from 'primevue/tag'\nimport { computed } from 'vue'\n\nimport { KeyComboImpl } from '@/stores/keybindingStore'\n\nconst props = withDefaults(\n  defineProps<{\n    keyCombo: KeyComboImpl\n    isModified: boolean\n  }>(),\n  {\n    isModified: false\n  }\n)\n\nconst keySequences = computed(() => props.keyCombo.getKeySequences())\n</script>\n","<template>\n  <PanelTemplate value=\"Keybinding\" class=\"keybinding-panel\">\n    <template #header>\n      <SearchBox\n        v-model=\"filters['global'].value\"\n        :placeholder=\"$t('g.searchKeybindings') + '...'\"\n      />\n    </template>\n\n    <DataTable\n      :value=\"commandsData\"\n      v-model:selection=\"selectedCommandData\"\n      :global-filter-fields=\"['id']\"\n      :filters=\"filters\"\n      selectionMode=\"single\"\n      stripedRows\n      :pt=\"{\n        header: 'px-0'\n      }\"\n    >\n      <Column field=\"actions\" header=\"\">\n        <template #body=\"slotProps\">\n          <div class=\"actions invisible flex flex-row\">\n            <Button\n              icon=\"pi pi-pencil\"\n              class=\"p-button-text\"\n              @click=\"editKeybinding(slotProps.data)\"\n            />\n            <Button\n              icon=\"pi pi-trash\"\n              class=\"p-button-text p-button-danger\"\n              @click=\"removeKeybinding(slotProps.data)\"\n              :disabled=\"!slotProps.data.keybinding\"\n            />\n          </div>\n        </template>\n      </Column>\n      <Column\n        field=\"id\"\n        :header=\"$t('g.command')\"\n        sortable\n        class=\"max-w-64 2xl:max-w-full\"\n      >\n        <template #body=\"slotProps\">\n          <div\n            class=\"overflow-hidden text-ellipsis whitespace-nowrap\"\n            :title=\"slotProps.data.id\"\n          >\n            {{ slotProps.data.label }}\n          </div>\n        </template>\n      </Column>\n      <Column field=\"keybinding\" :header=\"$t('g.keybinding')\">\n        <template #body=\"slotProps\">\n          <KeyComboDisplay\n            v-if=\"slotProps.data.keybinding\"\n            :keyCombo=\"slotProps.data.keybinding.combo\"\n            :isModified=\"\n              keybindingStore.isCommandKeybindingModified(slotProps.data.id)\n            \"\n          />\n          <span v-else>-</span>\n        </template>\n      </Column>\n    </DataTable>\n\n    <Dialog\n      class=\"min-w-96\"\n      v-model:visible=\"editDialogVisible\"\n      modal\n      :header=\"currentEditingCommand?.id\"\n      @hide=\"cancelEdit\"\n    >\n      <div>\n        <InputText\n          class=\"mb-2 text-center\"\n          ref=\"keybindingInput\"\n          :modelValue=\"newBindingKeyCombo?.toString() ?? ''\"\n          placeholder=\"Press keys for new binding\"\n          @keydown.stop.prevent=\"captureKeybinding\"\n          autocomplete=\"off\"\n          fluid\n          :invalid=\"!!existingKeybindingOnCombo\"\n        />\n        <Message v-if=\"existingKeybindingOnCombo\" severity=\"error\">\n          Keybinding already exists on\n          <Tag\n            severity=\"secondary\"\n            :value=\"existingKeybindingOnCombo.commandId\"\n          />\n        </Message>\n      </div>\n      <template #footer>\n        <Button\n          label=\"Save\"\n          icon=\"pi pi-check\"\n          @click=\"saveKeybinding\"\n          :disabled=\"!!existingKeybindingOnCombo\"\n          autofocus\n        />\n      </template>\n    </Dialog>\n    <Button\n      class=\"mt-4\"\n      :label=\"$t('g.reset')\"\n      v-tooltip=\"$t('g.resetKeybindingsTooltip')\"\n      icon=\"pi pi-trash\"\n      severity=\"danger\"\n      fluid\n      text\n      @click=\"resetKeybindings\"\n    />\n  </PanelTemplate>\n</template>\n\n<script setup lang=\"ts\">\nimport { FilterMatchMode } from '@primevue/core/api'\nimport Button from 'primevue/button'\nimport Column from 'primevue/column'\nimport DataTable from 'primevue/datatable'\nimport Dialog from 'primevue/dialog'\nimport InputText from 'primevue/inputtext'\nimport Message from 'primevue/message'\nimport Tag from 'primevue/tag'\nimport { useToast } from 'primevue/usetoast'\nimport { computed, ref, watchEffect } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport SearchBox from '@/components/common/SearchBox.vue'\nimport { useKeybindingService } from '@/services/keybindingService'\nimport { useCommandStore } from '@/stores/commandStore'\nimport {\n  KeyComboImpl,\n  KeybindingImpl,\n  useKeybindingStore\n} from '@/stores/keybindingStore'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\n\nimport PanelTemplate from './PanelTemplate.vue'\nimport KeyComboDisplay from './keybinding/KeyComboDisplay.vue'\n\nconst filters = ref({\n  global: { value: '', matchMode: FilterMatchMode.CONTAINS }\n})\n\nconst keybindingStore = useKeybindingStore()\nconst keybindingService = useKeybindingService()\nconst commandStore = useCommandStore()\nconst { t } = useI18n()\n\ninterface ICommandData {\n  id: string\n  keybinding: KeybindingImpl | null\n}\n\nconst commandsData = computed<ICommandData[]>(() => {\n  return Object.values(commandStore.commands).map((command) => ({\n    id: command.id,\n    label: t(`commands.${normalizeI18nKey(command.id)}.label`, command.label),\n    keybinding: keybindingStore.getKeybindingByCommandId(command.id)\n  }))\n})\n\nconst selectedCommandData = ref<ICommandData | null>(null)\nconst editDialogVisible = ref(false)\nconst newBindingKeyCombo = ref<KeyComboImpl | null>(null)\nconst currentEditingCommand = ref<ICommandData | null>(null)\nconst keybindingInput = ref(null)\n\nconst existingKeybindingOnCombo = computed<KeybindingImpl | null>(() => {\n  if (!currentEditingCommand.value) {\n    return null\n  }\n\n  // If the new keybinding is the same as the current editing command, then don't show the error\n  if (\n    currentEditingCommand.value.keybinding?.combo?.equals(\n      newBindingKeyCombo.value\n    )\n  ) {\n    return null\n  }\n\n  if (!newBindingKeyCombo.value) {\n    return null\n  }\n\n  return keybindingStore.getKeybinding(newBindingKeyCombo.value)\n})\n\nfunction editKeybinding(commandData: ICommandData) {\n  currentEditingCommand.value = commandData\n  newBindingKeyCombo.value = commandData.keybinding\n    ? commandData.keybinding.combo\n    : null\n  editDialogVisible.value = true\n}\n\nwatchEffect(() => {\n  if (editDialogVisible.value) {\n    // nextTick doesn't work here, so we use a timeout instead\n    setTimeout(() => {\n      keybindingInput.value?.$el?.focus()\n    }, 300)\n  }\n})\n\nfunction removeKeybinding(commandData: ICommandData) {\n  if (commandData.keybinding) {\n    keybindingStore.unsetKeybinding(commandData.keybinding)\n    keybindingService.persistUserKeybindings()\n  }\n}\n\nfunction captureKeybinding(event: KeyboardEvent) {\n  const keyCombo = KeyComboImpl.fromEvent(event)\n  newBindingKeyCombo.value = keyCombo\n}\n\nfunction cancelEdit() {\n  editDialogVisible.value = false\n  currentEditingCommand.value = null\n  newBindingKeyCombo.value = null\n}\n\nfunction saveKeybinding() {\n  if (currentEditingCommand.value && newBindingKeyCombo.value) {\n    const updated = keybindingStore.updateKeybindingOnCommand(\n      new KeybindingImpl({\n        commandId: currentEditingCommand.value.id,\n        combo: newBindingKeyCombo.value\n      })\n    )\n    if (updated) {\n      keybindingService.persistUserKeybindings()\n    }\n  }\n  cancelEdit()\n}\n\nconst toast = useToast()\nasync function resetKeybindings() {\n  keybindingStore.resetKeybindings()\n  await keybindingService.persistUserKeybindings()\n  toast.add({\n    severity: 'info',\n    summary: 'Info',\n    detail: 'Keybindings reset',\n    life: 3000\n  })\n}\n</script>\n\n<style scoped>\n:deep(.p-datatable-tbody) > tr > td {\n  @apply p-1;\n  min-height: 2rem;\n}\n\n:deep(.p-datatable-row-selected) .actions,\n:deep(.p-datatable-selectable-row:hover) .actions {\n  @apply visible;\n}\n</style>\n"],"names":[],"mappings":"qoCAiBA,MAAM,MAAQ,QAUR,aAAe,SAAS,IAAM,MAAM,SAAS,iBAAiB,8qBCkHpE,MAAM,QAAU,IAAI,CAClB,OAAQ,CAAE,MAAO,GAAI,UAAW,gBAAgB,QAAS,CAAA,CAC1D,EAEK,gBAAkB,qBAClB,kBAAoB,uBACpB,aAAe,kBACf,CAAE,GAAM,UAOR,aAAe,SAAyB,IACrC,OAAO,OAAO,aAAa,QAAQ,EAAE,IAAK,UAAa,CAC5D,GAAI,QAAQ,GACZ,MAAO,EAAE,YAAY,iBAAiB,QAAQ,EAAE,CAAC,SAAU,QAAQ,KAAK,EACxE,WAAY,gBAAgB,yBAAyB,QAAQ,EAAE,CAC/D,EAAA,CACH,EAEK,oBAAsB,IAAyB,IAAI,EACnD,kBAAoB,IAAI,EAAK,EAC7B,mBAAqB,IAAyB,IAAI,EAClD,sBAAwB,IAAyB,IAAI,EACrD,gBAAkB,IAAI,IAAI,EAE1B,0BAA4B,SAAgC,IAC5D,CAAC,sBAAsB,OAMzB,sBAAsB,MAAM,YAAY,OAAO,OAC7C,mBAAmB,KAAA,GAMnB,CAAC,mBAAmB,MACf,KAGF,gBAAgB,cAAc,mBAAmB,KAAK,CAC9D,EAED,SAAS,eAAe,YAA2B,CACjD,sBAAsB,MAAQ,YAC9B,mBAAmB,MAAQ,YAAY,WACnC,YAAY,WAAW,MACvB,KACJ,kBAAkB,MAAQ,EAC5B,CANS,wCAQT,YAAY,IAAM,CACZ,kBAAkB,OAEpB,WAAW,IAAM,CACC,gBAAA,OAAO,KAAK,SAC3B,GAAG,CACR,CACD,EAED,SAAS,iBAAiB,YAA2B,CAC/C,YAAY,aACE,gBAAA,gBAAgB,YAAY,UAAU,EACtD,kBAAkB,uBAAuB,EAE7C,CALS,4CAOT,SAAS,kBAAkB,MAAsB,CACzC,MAAA,SAAW,aAAa,UAAU,KAAK,EAC7C,mBAAmB,MAAQ,QAC7B,CAHS,8CAKT,SAAS,YAAa,CACpB,kBAAkB,MAAQ,GAC1B,sBAAsB,MAAQ,KAC9B,mBAAmB,MAAQ,IAC7B,CAJS,gCAMT,SAAS,gBAAiB,CACpB,sBAAsB,OAAS,mBAAmB,OACpC,gBAAgB,0BAC9B,IAAI,eAAe,CACjB,UAAW,sBAAsB,MAAM,GACvC,MAAO,mBAAmB,KAAA,CAC3B,CAAA,GAGD,kBAAkB,uBAAuB,EAGlC,YACb,CAbS,wCAeT,MAAM,MAAQ,WACd,eAAe,kBAAmB,CAChC,gBAAgB,iBAAiB,EACjC,MAAM,kBAAkB,yBACxB,MAAM,IAAI,CACR,SAAU,OACV,QAAS,OACT,OAAQ,oBACR,KAAM,GAAA,CACP,CACH,CATe"}